<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lag-Hubb - Arboga Stad Cup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 0;
        }

        .navbar {
            width: 100%;
            background-color: #1a202c;
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .navbar-home-logo {
            height: 2.5rem;
            margin-right: 1.5rem;
            cursor: pointer;
            border-radius: 9999px;
            transition: transform 0.2s ease-in-out;
            flex-shrink: 0;
        }

        .navbar-home-logo:hover {
            transform: scale(1.05);
        }

        .navbar-links-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            flex-grow: 1;
            justify-content: center;
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 0.8rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease-in-out;
            font-weight: 500;
            white-space: nowrap;
        }

        .navbar a:hover {
            background-color: #4a5568;
        }

        .content-container {
            max-width: 1000px;
            /* Wider for hub */
            width: 100%;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem 1.5rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
            flex-grow: 1;
        }

        .team-hub-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .team-hub-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e2e8f0;
        }

        .team-hub-name {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1a202c;
        }

        .team-hub-group {
            font-size: 1.25rem;
            color: #4a5568;
        }

        .hub-section {
            background-color: #f7fafc;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .hub-section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #cbd5e0;
        }

        .player-list-item-hub {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .player-list-item-hub:last-child {
            border-bottom: none;
        }

        .match-item {
            background-color: #fff;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            border: 1px solid #e2e8f0;
            /* Added a subtle border */
        }

        .match-item.upcoming {
            border-left: 4px solid #fbbf24;
            /* Amber for upcoming */
        }

        .match-item.past {
            border-left: 4px solid #60a5fa;
            /* Blue for past */
            opacity: 0.9;
        }

        .match-item strong {
            font-weight: 600;
        }


        .footer {
            width: 100%;
            background-color: #1a202c;
            padding: 1.5rem;
            text-align: center;
            margin-top: auto;
        }

        .footer-logo {
            max-width: 100%;
            height: 6rem;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }

        @media (max-width: 640px) {
            .navbar {
                flex-direction: column;
                align-items: center;
            }

            .navbar-home-logo {
                margin-right: 0;
                margin-bottom: 1rem;
            }

            .navbar-links-wrapper {
                width: 100%;
                justify-content: center;
            }

            .team-hub-header {
                flex-direction: column;
                text-align: center;
            }

            .overview-standings-container {
                /* Ensure stacking on mobile */
                flex-direction: column;
            }
        }

        /* Overview section specific styles */
        .overview-section {
            flex-grow: 1;
        }

        /* Highlighted players styling */
        .highlighted-player-info {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #cbd5e0;
        }

        .highlighted-player-info p {
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }

        .highlighted-player-info strong {
            color: #2c5282;
            /* Darker blue for emphasis */
        }

        .team-additional-info {
            font-size: 0.9rem;
            /* Slightly smaller text for these details */
            color: #4a5568;
        }

        .team-additional-info p .font-semibold {
            color: #2d3748;
            /* Darker label */
        }

        /* Group standings table within Spelartrupp section */
        .group-standings-in-hub {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .group-standings-in-hub h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.75rem;
        }

        .mini-standings-table {
            width: 100%;
            font-size: 0.85rem;
            border-collapse: collapse;
        }

        .mini-standings-table th,
        .mini-standings-table td {
            padding: 0.4rem 0.6rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .mini-standings-table th {
            background-color: #f7fafc;
            font-weight: 600;
        }

        .mini-standings-table .team-name-cell {
            font-weight: 600;
        }

        .mini-standings-table .points-cell {
            font-weight: 700;
            color: #3b82f6;
        }
    </style>
</head>

<body class="flex flex-col">
    <nav class="navbar">
        <a href="index.html">
            <img src="https://i.imgur.com/pwnWIDU.png" alt="Arboga Stad SK Logo" class="navbar-home-logo">
        </a>
        <div class="navbar-links-wrapper">
            <a href="index.html">Startsida</a>
            <a href="fotbollsschema.html">Spelschema</a>
            <a href="lagregister.html">Lagregister</a>
            <a href="tabeller.html">Tabeller</a>
            <a href="sponsorer.html">Samarbetspartners</a>
            <a href="aktiviteter.html">Aktiviteter</a>
            <a href="efterfesten.html">Efterfesten</a>
        </div>
    </nav>

    <div class="content-container">
        <header id="team-hub-header" class="team-hub-header">
            <img id="team-logo-hub" src="https://placehold.co/80x80/aabbcc/ffffff?text=Lag" alt="Lag Logotyp"
                class="team-hub-logo">
            <div>
                <h1 id="team-name-hub" class="team-hub-name">Laddar laginfo...</h1>
                <p id="team-group-hub" class="team-hub-group">Grupp X</p>
            </div>
        </header>

        <main id="team-hub-content">
            <!-- Team Overview -->
            <section class="hub-section overview-section">
                <h2 class="hub-section-title">Översikt</h2>
                <p id="team-description-hub" class="mb-2 text-gray-700">Lagbeskrivning laddas...</p>

                <div class="team-additional-info mt-3 pt-3 border-t border-gray-200">
                    <p class="mb-1"><span class="font-semibold">Spelstil:</span> <span
                            id="team-style-hub">Laddar...</span></p>
                    <p class="mb-1"><span class="font-semibold">Hemligt Vapen:</span> <span
                            id="team-secret-weapon-hub">Laddar...</span></p>
                    <p class="mb-1"><span class="font-semibold">Motståndet:</span> <span
                            id="team-highlight-ops-hub">Laddar...</span></p>
                    <p class="mb-1"><span class="font-semibold">Största hotet i gruppen:</span> <span
                            id="team-group-threat-hub">Laddar...</span></p>
                    <p class="mb-1"><span class="font-semibold">Lagets erfarenhet:</span> <span
                            id="team-exp-hub">Laddar...</span></p>
                    <p class="mb-1"><span class="font-semibold">:</span> <span
                            id="team-celebration-hub">Laddar...</span></p>
                </div>

                <p class="mt-2 mb-1"><span class="font-semibold">Motto:</span> <span
                        id="team-motto-hub">Laddar...</span></p>
                <p class="mb-2"><span class="font-semibold">Lagkapten:</span> <span
                        id="team-captain-hub">Laddar...</span></p>

                <div id="highlighted-players-hub" class="highlighted-player-info">
                    <p><span class="font-semibold">Skyttekung:</span> <span id="hub-top-scorer-name">Laddar...</span>
                    </p>
                    <p><span class="font-semibold">Domarens Favorit:</span> <span
                            id="hub-top-card-player-name">Laddar...</span></p>
                </div>

                <div id="team-sponsor-info-hub" class="mt-4">
                    <h3 class="font-semibold text-gray-800">Sponsor:</h3>
                    <p id="team-sponsor-name-hub">Laddar...</p>
                    <img id="team-sponsor-logo-hub" src="" alt="Sponsor Logotyp" class="max-h-16 mt-2 hidden">
                </div>
            </section>

            <!-- Merged Matches Section -->
            <section class="hub-section">
                <h2 class="hub-section-title">Matcher</h2>
                <div id="all-matches-hub">
                    <p class="text-gray-500">Laddar matcher...</p>
                </div>
            </section>

            <!-- Player Roster & Stats -->
            <section class="hub-section">
                <h2 class="hub-section-title">Spelartrupp & Statistik</h2>
                <div id="player-roster-hub">
                    <p class="text-gray-500">Laddar spelartrupp...</p>
                </div>
                <div id="group-standings-in-hub-container" class="group-standings-in-hub">
                    <!-- Group standings table will be inserted here by JS -->
                </div>
            </section>
        </main>
    </div>

    <footer class="footer">
        <img src="https://i.imgur.com/9q8c3ab.png" alt="Cup Footer Logo" class="footer-logo">
    </footer>

    <script>
        // URLs to your Google Sheets (ensure they are published as CSV)
        const TEAMS_INFO_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=213368947&single=true&output=csv';
        const SCHEDULE_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=894699500&single=true&output=csv';
        const PLAYER_STATS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=1809976994&single=true&output=csv';
        const STANDINGS_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=1900542434&single=true&output=csv';

        function parseRobustCsv(csvText) {
            const rows = [];
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length <= 1) return [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                const values = [];
                let inQuote = false;
                let currentField = '';
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    const nextChar = line[j + 1];
                    if (char === '"') {
                        if (inQuote && nextChar === '"') {
                            currentField += char; j++;
                        } else {
                            inQuote = !inQuote;
                        }
                    } else if (char === ',' && !inQuote) {
                        values.push(currentField.trim()); currentField = '';
                    } else {
                        currentField += char;
                    }
                }
                values.push(currentField.trim());
                rows.push(values);
            }
            return rows;
        }

        function isValidImageUrl(url) {
            if (!url || typeof url !== 'string') return false;
            return (url.startsWith('http://') || url.startsWith('https://')) &&
                (/\.(jpeg|jpg|gif|png|webp|svg)(\?raw=true)?$/i.test(url));
        }

        async function fetchCsvData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error ${response.status} for ${url}`);
                return await response.text();
            } catch (error) {
                console.error(`Failed to fetch CSV from ${url}:`, error);
                return null;
            }
        }

        function parseTeamsInfo(csvText) {
            const rawRows = parseRobustCsv(csvText);
            return rawRows.map(values => {
                if (values.length < 15) { // Expecting 15 columns from PUB_TEAMINFO for full details
                    console.warn(`TeamInfo: Skipped row due to insufficient columns. Expected 15, got ${values.length}. Row: ${values.join('|')}`);
                    return null;
                }
                const team = {
                    teamName: values[0]?.trim() || 'N/A',
                    logo: (values[1] && isValidImageUrl(values[1].trim())) ? values[1].trim() : 'https://placehold.co/80x80/aabbcc/ffffff?text=Lag',
                    captainName: values[2]?.trim() || 'N/A',
                    group: values[3]?.trim() || 'N/A',
                    teamDescription: values[4]?.trim() || 'N/A',
                    teamStyle: values[5]?.trim() || 'N/A',
                    secretWeapon: values[6]?.trim() || 'N/A',
                    highlightOps: values[7]?.trim() || 'N/A',
                    groupThreat: values[8]?.trim() || 'N/A',
                    teamExp: values[9]?.trim() || 'N/A',
                    celebration: values[10]?.trim() || 'N/A',
                    motto: values[11]?.trim() || 'N/A',
                    playersRaw: values[12]?.trim() || '',
                    shortDescription: values[13]?.trim() || '', // Parsed but not directly used in hub display here
                    sponsorInfoRaw: values[14]?.trim() || 'N/A',
                };

                team.sponsorName = 'N/A';
                team.sponsorLogoUrl = null;
                if (team.sponsorInfoRaw && team.sponsorInfoRaw.toLowerCase() !== 'n/a') {
                    const parts = team.sponsorInfoRaw.split(';');
                    team.sponsorName = parts[0]?.trim() || 'N/A';
                    if (parts.length > 1 && parts[1]?.trim() && isValidImageUrl(parts[1].trim())) {
                        team.sponsorLogoUrl = parts[1].trim();
                    }
                }
                return team;
            }).filter(Boolean);
        }

        function parseSchedule(csvText) {
            const rawRows = parseRobustCsv(csvText);
            return rawRows.map(values => {
                if (values.length < 8) return null;
                return {
                    matchId: values[0]?.trim() || 'N/A',
                    time: values[1]?.trim() || 'N/A',
                    team1: values[2]?.trim() || 'N/A',
                    team2: values[3]?.trim() || 'N/A',
                    venue: values[4]?.trim() || 'N/A',
                    group: values[5]?.trim() || 'N/A',
                    result: values[6]?.trim() || 'N/A',
                    matchStatus: values[7]?.trim() || 'N/A'
                };
            }).filter(Boolean);
        }

        function parsePlayerStats(csvText) {
            const rawRows = parseRobustCsv(csvText);
            return rawRows.map(values => {
                if (values.length < 7) return null;
                return {
                    team: values[0]?.trim() || 'N/A',
                    playerName: values[1]?.trim() || 'N/A',
                    group: values[2]?.trim() || 'N/A',
                    jerseyNumber: parseInt(values[3]) || 'N/A',
                    goals: parseInt(values[4]) || 0,
                    yellowCards: parseInt(values[5]) || 0,
                    redCards: parseInt(values[6]) || 0
                };
            }).filter(Boolean);
        }

        function parseStandings(csvText) {
            const rawRows = parseRobustCsv(csvText);
            return rawRows.map(values => {
                if (values.length < 11) return null;
                const parseNumericWithMinus = (valStr) => {
                    if (typeof valStr !== 'string') return parseInt(valStr) || 0;
                    return parseInt(valStr.replace(/\s/g, '').replace('−', '-')) || 0;
                };
                return {
                    teamName: values[0]?.trim() || 'N/A',
                    group: values[1]?.trim() || 'N/A',
                    matchesPlayed: parseNumericWithMinus(values[2]),
                    wins: parseNumericWithMinus(values[3]),
                    draws: parseNumericWithMinus(values[4]),
                    losses: parseNumericWithMinus(values[5]),
                    goalsFor: parseNumericWithMinus(values[6]),
                    goalsAgainst: parseNumericWithMinus(values[7]),
                    goalDifference: parseNumericWithMinus(values[8]),
                    points: parseNumericWithMinus(values[9]),
                    nextMatch: values[10]?.trim() || 'N/A'
                };
            }).filter(Boolean);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const teamNameQuery = urlParams.get('team');

            if (!teamNameQuery) {
                document.getElementById('team-name-hub').textContent = 'Inget lag valt';
                document.getElementById('team-hub-content').innerHTML = '<p class="text-red-500 text-center">Vänligen välj ett lag från lagregistret.</p>';
                return;
            }

            document.title = `${teamNameQuery} - Lag-Hubb - Arboga Stad Cup`;

            const [teamsInfoText, scheduleText, playerStatsText, standingsText] = await Promise.all([
                fetchCsvData(TEAMS_INFO_CSV_URL),
                fetchCsvData(SCHEDULE_CSV_URL),
                fetchCsvData(PLAYER_STATS_CSV_URL),
                fetchCsvData(STANDINGS_CSV_URL)
            ]);

            const allTeamsInfo = teamsInfoText ? parseTeamsInfo(teamsInfoText) : [];
            const allScheduledGames = scheduleText ? parseSchedule(scheduleText) : [];
            const allPlayerStats = playerStatsText ? parsePlayerStats(playerStatsText) : [];
            const allStandings = standingsText ? parseStandings(standingsText) : [];

            const currentTeamInfo = allTeamsInfo.find(t => t.teamName === teamNameQuery);

            if (!currentTeamInfo) {
                document.getElementById('team-name-hub').textContent = `Lag "${teamNameQuery}" hittades inte.`;
                document.getElementById('team-hub-content').innerHTML = '<p class="text-red-500 text-center">Kontrollera lagnamnet och försök igen.</p>';
                return;
            }

            document.getElementById('team-logo-hub').src = currentTeamInfo.logo;
            document.getElementById('team-logo-hub').alt = `${currentTeamInfo.teamName} Logotyp`;
            document.getElementById('team-name-hub').textContent = currentTeamInfo.teamName;
            document.getElementById('team-group-hub').textContent = `Grupp ${currentTeamInfo.group || 'N/A'}`;

            // Populate Overview
            document.getElementById('team-description-hub').textContent = currentTeamInfo.teamDescription && currentTeamInfo.teamDescription.toLowerCase() !== 'n/a' ? currentTeamInfo.teamDescription : 'Ingen beskrivning tillgänglig.';

            document.getElementById('team-style-hub').textContent = currentTeamInfo.teamStyle && currentTeamInfo.teamStyle.toLowerCase() !== 'n/a' ? currentTeamInfo.teamStyle : '-';
            document.getElementById('team-secret-weapon-hub').textContent = currentTeamInfo.secretWeapon && currentTeamInfo.secretWeapon.toLowerCase() !== 'n/a' ? currentTeamInfo.secretWeapon : '-';
            document.getElementById('team-highlight-ops-hub').textContent = currentTeamInfo.highlightOps && currentTeamInfo.highlightOps.toLowerCase() !== 'n/a' ? currentTeamInfo.highlightOps : '-';
            document.getElementById('team-group-threat-hub').textContent = currentTeamInfo.groupThreat && currentTeamInfo.groupThreat.toLowerCase() !== 'n/a' ? currentTeamInfo.groupThreat : '-';
            document.getElementById('team-exp-hub').textContent = currentTeamInfo.teamExp && currentTeamInfo.teamExp.toLowerCase() !== 'n/a' ? currentTeamInfo.teamExp : '-';
            document.getElementById('team-celebration-hub').textContent = currentTeamInfo.celebration && currentTeamInfo.celebration.toLowerCase() !== 'n/a' ? currentTeamInfo.celebration : '-';

            document.getElementById('team-motto-hub').textContent = currentTeamInfo.motto && currentTeamInfo.motto.toLowerCase() !== 'n/a' ? currentTeamInfo.motto : '-';
            document.getElementById('team-captain-hub').textContent = currentTeamInfo.captainName && currentTeamInfo.captainName.toLowerCase() !== 'n/a' ? currentTeamInfo.captainName : '-';


            if (currentTeamInfo.sponsorName && currentTeamInfo.sponsorName.toLowerCase() !== 'n/a') {
                document.getElementById('team-sponsor-name-hub').textContent = currentTeamInfo.sponsorName;
                if (currentTeamInfo.sponsorLogoUrl && currentTeamInfo.sponsorLogoUrl.toLowerCase() !== 'n/a') {
                    const sponsorLogoImg = document.getElementById('team-sponsor-logo-hub');
                    sponsorLogoImg.src = currentTeamInfo.sponsorLogoUrl;
                    sponsorLogoImg.alt = `${currentTeamInfo.sponsorName} Logotyp`;
                    sponsorLogoImg.classList.remove('hidden');
                }
            } else {
                document.getElementById('team-sponsor-info-hub').innerHTML = '<p>Ingen huvudsponsor angiven.</p>';
            }

            const hubTopScorerName = document.getElementById('hub-top-scorer-name');
            const hubTopCardPlayerName = document.getElementById('hub-top-card-player-name');
            if (allPlayerStats.length > 0) {
                const teamPlayers = allPlayerStats.filter(p => p.team === currentTeamInfo.teamName);
                if (teamPlayers.length > 0) {
                    const topScorer = [...teamPlayers].sort((a, b) => b.goals - a.goals)[0];
                    if (topScorer && topScorer.goals > 0) {
                        hubTopScorerName.textContent = `${topScorer.playerName} (${topScorer.goals} mål)`;
                    } else {
                        hubTopScorerName.textContent = 'Inga mål registrerade';
                    }
                    const topCardPlayer = [...teamPlayers].sort((a, b) => (b.redCards * 2 + b.yellowCards) - (a.redCards * 2 + a.yellowCards))[0]; // Red card counts as 2 for sorting
                    const totalCardPoints = topCardPlayer ? (topCardPlayer.redCards * 2 + topCardPlayer.yellowCards) : 0;
                    if (topCardPlayer && totalCardPoints > 0) {
                        hubTopCardPlayerName.textContent = `${topCardPlayer.playerName} (${topCardPlayer.yellowCards}G, ${topCardPlayer.redCards}R)`;
                    } else {
                        hubTopCardPlayerName.textContent = 'Inga kort registrerade';
                    }
                } else {
                    hubTopScorerName.textContent = 'Statistik saknas';
                    hubTopCardPlayerName.textContent = 'Statistik saknas';
                }
            } else {
                hubTopScorerName.textContent = 'Statistik ej tillgänglig';
                hubTopCardPlayerName.textContent = 'Statistik ej tillgänglig';
            }

            // Populate All Matches (Merged Section)
            const allMatchesDiv = document.getElementById('all-matches-hub');
            const teamAllGames = allScheduledGames.filter(game =>
                (game.team1 === teamNameQuery || game.team2 === teamNameQuery)
            ).sort((a, b) => {
                const timeA = new Date(`1970/01/01 ${a.time}`); // Create comparable date objects
                const timeB = new Date(`1970/01/01 ${b.time}`);
                if (timeA < timeB) return -1;
                if (timeA > timeB) return 1;

                const statusOrder = { 'Kommande': 1, 'Pågående': 2, 'Slutrapporterad': 3 }; // Pågående before Slutrapporterad
                const statusA = statusOrder[a.matchStatus] || 4; // Default for other statuses
                const statusB = statusOrder[b.matchStatus] || 4;
                return statusA - statusB;
            });

            if (teamAllGames.length > 0) {
                allMatchesDiv.innerHTML = teamAllGames.map(game => {
                    let matchClass = 'match-item';
                    let matchInfo = `<strong>${game.time}</strong> vs ${game.team1 === teamNameQuery ? game.team2 : game.team1} på ${game.venue || 'Okänd plan'}`;

                    if (game.matchStatus === 'Slutrapporterad' && game.result && game.result !== 'N/A' && game.result.trim() !== '' && game.result.trim() !== '-') {
                        matchClass += ' past';
                        matchInfo = `${game.team1} <strong>${game.result}</strong> ${game.team2} (${game.time})`;
                    } else if (game.matchStatus === 'Kommande' || game.matchStatus === 'Pågående') {
                        matchClass += ' upcoming';
                        if (game.matchStatus === 'Pågående') matchInfo += ` <span class="text-red-500 font-semibold">(Pågår)</span>`;
                    }
                    return `<div class="${matchClass}">${matchInfo}</div>`;
                }).join('');
            } else {
                allMatchesDiv.innerHTML = '<p class="text-gray-500">Inga matcher schemalagda för detta lag.</p>';
            }


            const playerRosterDiv = document.getElementById('player-roster-hub');
            const teamPlayersStats = allPlayerStats.filter(player => player.team === teamNameQuery);
            let playersToDisplay = [];
            if (teamPlayersStats.length > 0) {
                playersToDisplay = teamPlayersStats.map(p => ({
                    name: p.playerName,
                    goals: p.goals,
                    yellowCards: p.yellowCards,
                    redCards: p.redCards
                }));
            } else if (currentTeamInfo.playersRaw) {
                playersToDisplay = currentTeamInfo.playersRaw.split(',').map(name => ({
                    name: name.replace(/\s*\(K\)|\s*\(MV\)/i, '').trim(),
                    goals: '?', yellowCards: '?', redCards: '?'
                }));
            }
            if (playersToDisplay.length > 0) {
                playersToDisplay.sort((a, b) => a.name.localeCompare(b.name));
                playerRosterDiv.innerHTML = playersToDisplay.map(player => `
                    <div class="player-list-item-hub">
                        <span>${player.name}</span>
                        <span class="text-xs">
                            Mål: ${player.goals} | G: ${player.yellowCards} | R: ${player.redCards}
                        </span>
                    </div>
                `).join('');
            } else {
                playerRosterDiv.innerHTML = '<p class="text-gray-500">Ingen spelartrupp tillgänglig.</p>';
            }

            const groupStandingsInHubContainer = document.getElementById('group-standings-in-hub-container');
            if (currentTeamInfo.group && currentTeamInfo.group !== 'N/A' && allStandings.length > 0) {
                const teamsInThisGroup = allStandings
                    .filter(s => s.group === currentTeamInfo.group)
                    .sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                        return b.goalsFor - a.goalsFor;
                    });

                if (teamsInThisGroup.length > 0) {
                    let tableHtml = `<h3>Ställning Grupp ${currentTeamInfo.group}</h3>
                                     <table class="mini-standings-table">
                                        <thead>
                                            <tr><th>Lag</th><th>P</th><th>M</th><th>V</th><th>O</th><th>F</th><th>MS</th></tr>
                                        </thead>
                                        <tbody>`;
                    teamsInThisGroup.forEach(team => {
                        tableHtml += `<tr>
                                        <td class="team-name-cell">${team.teamName}</td>
                                        <td class="points-cell">${team.points}</td>
                                        <td>${team.matchesPlayed}</td>
                                        <td>${team.wins}</td>
                                        <td>${team.draws}</td>
                                        <td>${team.losses}</td>
                                        <td>${team.goalDifference}</td>
                                      </tr>`;
                    });
                    tableHtml += `</tbody></table>`;
                    groupStandingsInHubContainer.innerHTML = tableHtml;
                } else {
                    groupStandingsInHubContainer.innerHTML = `<p class="text-gray-500">Ingen tabellinformation för Grupp ${currentTeamInfo.group}.</p>`;
                }
            } else {
                groupStandingsInHubContainer.innerHTML = `<p class="text-gray-500">Lagets gruppinformation saknas eller tabell ej tillgänglig.</p>`;
            }
        });
    </script>
</body>

</html>