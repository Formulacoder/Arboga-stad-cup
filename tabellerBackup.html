<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arboga Stad Cup - Tabeller</title>
    <!-- Tailwind CSS CDN för styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            /* Ljusgrå bakgrund */
            min-height: 100vh;
            /* Säkerställer att bakgrunden täcker hela sidan */
            display: flex;
            flex-direction: column;
            /* För att navbaren ska ligga överst */
            align-items: center;
            justify-content: flex-start;
            /* Justera för navbar */
            padding: 0;
            /* Ta bort padding från body */
        }

        .navbar {
            width: 100%;
            background-color: #1a202c;
            /* Mörk bakgrund för navbar */
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            /* Kvar på toppen vid scroll */
            top: 0;
            z-index: 1000;
            /* Säkerställ att den ligger över annat innehåll */
            display: flex;
            /* Använd flexbox */
            align-items: center;
            /* Centrera vertikalt */
            justify-content: flex-start;
            /* Starta objekt från vänster */
            flex-wrap: wrap;
            /* Tillåt objekt att bryta rad om utrymmet är begränsat */
        }

        .navbar-home-logo {
            height: 2.5rem;
            /* Storlek på logotypen som hemknapp */
            margin-right: 1.5rem;
            /* Mer utrymme till höger om logotypen */
            cursor: pointer;
            border-radius: 9999px;
            /* Rundad */
            transition: transform 0.2s ease-in-out;
            flex-shrink: 0;
            /* Förhindra att logotypen krymper */
        }

        .navbar-home-logo:hover {
            transform: scale(1.05);
            /* Lätt förstoring vid hover */
        }

        .navbar-links-wrapper {
            display: flex;
            flex-wrap: wrap;
            /* Tillåt länkar att bryta rad */
            gap: 0.5rem;
            /* Litet mellanrum mellan länkar */
            flex-grow: 1;
            /* Tillåt länkomslutningen att ta tillgängligt utrymme */
            justify-content: center;
            /* Centrera länkar inom deras omslutning på små skärmar om de bryter rad */
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 0.8rem;
            /* Något minskad padding för kompakthet */
            border-radius: 0.375rem;
            /* rounded-md */
            transition: background-color 0.2s ease-in-out;
            font-weight: 500;
            white-space: nowrap;
            /* Förhindra att länkar bryter text */
        }

        .navbar a:hover {
            background-color: #4a5568;
            /* Mörkare grå vid hover */
        }

        .content-container {
            max-width: 960px;
            /* max-w-4xl är ca 960px */
            width: 100%;
            background-color: #ffffff;
            border-radius: 0.75rem;
            /* rounded-xl */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem 1.5rem;
            /* Justerad padding */
            margin-top: 2rem;
            /* Marginal från navbar */
            margin-bottom: 2rem;
            flex-grow: 1;
            /* Låter innehållskontainern växa och pressa ner footern */
        }

        .section-heading {
            font-size: 2.25rem;
            /* text-4xl */
            font-weight: 800;
            /* font-extrabold */
            color: #1a202c;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .group-heading {
            font-size: 2rem;
            /* text-3xl */
            font-weight: 800;
            /* font-extrabold */
            color: #1a202c;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .table-container {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .standings-table,
        .results-table,
        .top-scorer-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .standings-table th,
        .standings-table td,
        .results-table th,
        .results-table td,
        .top-scorer-table th,
        .top-scorer-table td {
            padding: 0.75rem 0.5rem;
            /* Anpassad padding */
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            /* Lätt linje */
        }

        .standings-table th,
        .results-table th,
        .top-scorer-table th {
            background-color: #f0f4f8;
            /* Ljusare bakgrund för rubrik */
            color: #4a5568;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.05em;
        }

        .standings-table tbody tr:hover,
        .results-table tbody tr:hover,
        .top-scorer-table tbody tr:hover {
            background-color: #f7fafc;
            /* Ljusare rad vid hover */
        }

        .team-cell {
            font-weight: 600;
            display: flex;
            /* Flexbox för att centrera logotyp och text */
            align-items: center;
            /* Centrera vertikalt */
        }

        .team-logo-small {
            width: 1.5rem;
            /* Mindre logotyp i tabellen */
            height: 1.5rem;
            border-radius: 9999px;
            /* Rund */
            object-fit: cover;
            margin-right: 0.5rem;
            /* Mellanrum till text */
        }

        .points-cell,
        .goals-cell {
            font-weight: 700;
            color: #3b82f6;
            /* Blå färg för poäng/mål */
        }

        /* Justera kolumnbredder för tabeller */
        .standings-table th:nth-child(1),
        .standings-table td:nth-child(1) {
            width: 25%;
        }

        /* Lag */
        .standings-table th:nth-child(2),
        .standings-table td:nth-child(2) {
            width: 7%;
        }

        /* M */
        .standings-table th:nth-child(3),
        .standings-table td:nth-child(3) {
            width: 7%;
        }

        /* V */
        .standings-table th:nth-child(4),
        .standings-table td:nth-child(4) {
            width: 7%;
        }

        /* O */
        .standings-table th:nth-child(5),
        .standings-table td:nth-child(5) {
            width: 7%;
        }

        /* F */
        .standings-table th:nth-child(6),
        .standings-table td:nth-child(6) {
            width: 7%;
        }

        /* GM */
        .standings-table th:nth-child(7),
        .standings-table td:nth-child(7) {
            width: 7%;
        }

        /* IM */
        .standings-table th:nth-child(8),
        .standings-table td:nth-child(8) {
            width: 7%;
        }

        /* MS */
        .standings-table th:nth-child(9),
        .standings-table td:nth-child(9) {
            width: 10%;
        }

        /* P */
        .results-table td:nth-child(1) {
            width: 15%;
        }

        /* Matchid */
        .results-table th:nth-child(2),
        .results-table td:nth-child(2) {
            width: 15%;
        }

        /* Tid */
        .results-table th:nth-child(3),
        .results-table td:nth-child(3) {
            width: 25%;
        }

        /* Hemma */
        .results-table th:nth-child(4),
        .results-table td:nth-child(4) {
            width: 25%;
        }

        /* Borta */
        .results-table th:nth-child(5),
        .results-table td:nth-child(5) {
            width: 10%;
        }

        /* Resultat */
        .results-table th:nth-child(6),
        .results-table td:nth-child(6) {
            width: 10%;
        }

        /* Anmärkning */

        .top-scorer-table th:nth-child(1),
        .top-scorer-table td:nth-child(1) {
            width: 10%;
        }

        /* Rank */
        .top-scorer-table th:nth-child(2),
        .top-scorer-table td:nth-child(2) {
            width: 40%;
        }

        /* Namn */
        .top-scorer-table th:nth-child(3),
        .top-scorer-table td:nth-child(3) {
            width: 30%;
        }

        /* Lag */
        .top-scorer-table th:nth-child(4),
        .top-scorer-table td:nth-child(4) {
            width: 20%;
        }

        /* Mål */


        /* Styling for Qualified Teams section */
        .qualified-teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            margin-bottom: 2rem;
        }

        .qualified-team-card {
            background-color: #ebf8ff;
            /* Light blue background */
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
            font-weight: 600;
            color: #2b6cb0;
            border: 1px solid #90cdf4;
        }

        /* Footer styling */
        .footer {
            width: 100%;
            background-color: #1a202c;
            /* Mörk bakgrund för footer */
            padding: 1.5rem;
            text-align: center;
            margin-top: auto;
            /* Trycker ner footern till botten */
        }

        .footer-logo {
            max-width: 100%;
            /* Anpassa till skärmbredden */
            height: 6rem;
            /* FAST HÖJD FÖR FOTLOGOTYPEN, ÖKAD FRÅN 4REM TILL 6REM */
            object-fit: contain;
            /* Behåll proportioner, se till att hela bilden syns */
            display: block;
            /* Centrera bilden */
            margin: 0 auto;
            /* Centrera bilden horisontellt */
        }

        /* New styles for tabbed interface */
        .tab-buttons {
            display: flex;
            flex-wrap: wrap;
            /* Allows wrapping on smaller screens */
            justify-content: center;
            gap: 0.75rem;
            /* Space between buttons */
            margin-bottom: 1.5rem;
        }

        .tab-button {
            padding: 0.75rem 1.25rem;
            background-color: #e2e8f0;
            /* Light gray for inactive tabs */
            color: #4a5568;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            flex-grow: 1;
            /* Allows buttons to grow and fill space */
            text-align: center;
            min-width: 100px;
            /* Minimum width for buttons */
        }

        .tab-button.active {
            background-color: #3b82f6;
            /* Blue for active tab */
            color: white;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .tab-button:hover:not(.active) {
            background-color: #cbd5e0;
        }

        .tab-content {
            display: none;
            /* Hide all tab content by default */
        }

        .tab-content.active {
            display: block;
            /* Show active tab content */
        }

        /* Tournament bracket specific styles */
        .tournament-bracket {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem 1.5rem;
            margin-bottom: 2rem;
        }

        .bracket-stages {
            display: flex;
            flex-direction: column;
            /* Default to column for mobile */
            justify-content: space-around;
            width: 100%;
            max-width: 1000px;
            /* Max width for bracket */
            margin: 0 auto;
            /* Center the bracket */
        }

        .bracket-stage {
            flex: 1;
            /* Allow stages to grow */
            display: flex;
            flex-direction: column;
            gap: 1rem;
            /* Space between match cards */
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            /* Horizontal border for mobile */
            margin-bottom: 1rem;
            align-items: center;
            /* Center content in stage */
        }

        .bracket-stage:last-child {
            border-bottom: none;
            /* No border after the last stage on mobile */
            margin-bottom: 0;
        }

        .match-card {
            background-color: #f0f4f8;
            /* Ljusare bakgrund för matchkort */
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
            width: 100%;
            /* Take full width of its container */
            max-width: 250px;
            /* Max width for individual match card */
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 70px;
            /* Ensure a minimum height */
        }

        .match-card .team-name {
            font-weight: 600;
            color: #2d3748;
            padding: 0.2rem 0;
        }

        .match-card .score {
            font-weight: 700;
            color: #3b82f6;
            margin-top: 0.25rem;
            font-size: 1.1rem;
        }

        .match-card .vs-separator {
            font-size: 0.8rem;
            color: #718096;
            margin: -0.2rem 0;
            /* Adjust spacing around "vs" */
        }

        .winner-display {
            background-color: #d6e8ff;
            /* Ljusare blå för vinnare */
            border: 2px solid #3b82f6;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 2rem;
            font-size: 1.6rem;
            font-weight: 800;
            color: #1a202c;
            text-align: center;
            width: 100%;
            max-width: 300px;
            /* Constrain winner display width */
        }


        @media (min-width: 768px) {

            /* Medium screens and up (md) */
            .bracket-stages {
                flex-direction: row;
                /* Layout stages in a row */
                align-items: flex-start;
                /* Align stages to the top */
            }

            .bracket-stage {
                border-bottom: none;
                /* Remove horizontal border */
                border-right: 1px solid #e2e8f0;
                /* Add vertical border between stages */
                padding-right: 2rem;
                padding-left: 2rem;
                margin-bottom: 0;
                justify-content: space-around;
                /* Distribute space for matches */
                height: auto;
                /* Allow height to adjust */
            }

            .bracket-stage:first-child {
                padding-left: 0;
                /* No left padding for first stage */
            }

            .bracket-stage:last-child {
                border-right: none;
                /* No border after the last stage */
                padding-right: 0;
                /* No right padding for last stage */
            }

            .bracket-stage:nth-child(2) {
                /* Semifinaler */
                margin-top: 4rem;
                /* Offset for visual flow */
                margin-bottom: 4rem;
            }

            .bracket-stage:nth-child(3) {
                /* Final */
                margin-top: 8rem;
                /* Further offset for visual flow */
                margin-bottom: 8rem;
            }
        }

        @media (max-width: 640px) {

            /* För mobil (sm breakpoint) */
            .navbar {
                flex-direction: column;
                /* Stapla logotyp och länkar vertikalt */
                align-items: center;
                /* Centrera allt */
            }

            .navbar-home-logo {
                margin-right: 0;
                /* Ingen marginal till höger om logotypen om den är centrerad */
                margin-bottom: 1rem;
                /* Avstånd till länkarna nedanför */
            }

            .navbar-links-wrapper {
                width: 100%;
                /* Ta full bredd under logotypen */
                justify-content: center;
                /* Centrera länkar inom deras omslutning på små skärmar om de bryter rad */
            }

            .navbar a {
                width: auto;
                /* Låt länkarna bestämma sin egen bredd */
            }

            /* Generiska mobila tabellstilar för alla tabeller */
            .standings-table thead,
            .results-table thead,
            .top-scorer-table thead {
                display: none;
                /* Dölj tabellhuvud på små skärmar */
            }

            .standings-table,
            .standings-table tbody,
            .standings-table tr,
            .standings-table td,
            .results-table,
            .results-table tbody,
            .results-table tr,
            .results-table td,
            .top-scorer-table,
            .top-scorer-table tbody,
            .top-scorer-table tr,
            .top-scorer-table td {
                display: block;
                /* Visa element som block för staplad layout */
                width: 100%;
            }

            .standings-table tr,
            .results-table tr,
            .top-scorer-table tr {
                margin-bottom: 1rem;
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            }

            .standings-table td,
            .results-table td,
            .top-scorer-table td {
                text-align: right;
                /* Högerjustera värden */
                padding-left: 50%;
                /* Gör plats för etikett */
                position: relative;
                border: none;
            }

            .standings-table td::before,
            .results-table td::before,
            .top-scorer-table td::before {
                content: attr(data-label);
                /* Använd data-label som etikett */
                position: absolute;
                left: 0.5rem;
                width: calc(50% - 1rem);
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: 600;
                color: #4a5568;
            }

            /* Återställ kolumnbredder för mobilvy (auto) */
            .standings-table th,
            .standings-table td,
            .results-table th,
            .results-table td,
            .top-scorer-table th,
            .top-scorer-table td {
                width: auto !important;
                /* Åsidosätt specifika bredder */
            }

            .tab-button {
                min-width: unset;
                /* Remove min-width on very small screens */
                width: 100%;
                /* Take full width on very small screens */
            }
        }
    </style>
</head>

<body class="flex flex-col">
    <!-- Global Navigationsmeny -->
    <nav class="navbar">
        <a href="index.html">
            <img src="https://i.imgur.com/pwnWIDU.png" alt="Arboga Stad SK Logo" class="navbar-home-logo">
        </a>
        <div class="navbar-links-wrapper">
            <a href="index.html">Startsida</a>
            <a href="fotbollsschema.html">Spelschema</a>
            <a href="lagregister.html">Lagregister</a>
            <a href="spelaregister.html">Spelarregister</a>
            <a href="tabeller.html">Tabeller</a>
            <a href="sponsorer.html">Samarbetspartners</a>
            <a href="aktiviteter.html">Aktiviteter</a>
            <a href="efterfesten.html">Efterfesten</a>
        </div>
    </nav>

    <div class="content-container">
        <!-- Rubriksektion -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Resultat och Tabeller</h1>
            <p class="text-lg text-gray-600">Se ställningen och matchresultat från cupen.</p>
        </header>

        <!-- Just nu klara för slutspel sektion -->
        <h2 class="section-heading">Just nu klara för slutspel</h2>
        <div id="qualified-teams-list" class="table-container">
            <div class="text-center text-gray-500 p-4">Laddar kvalificerade lag...</div>
        </div>

        <!-- Tabeller sektion (Grupptabeller med knappar) -->
        <h2 class="section-heading">Grupptabeller</h2>
        <div class="tab-buttons" id="group-tab-buttons">
            <!-- Knappar genereras här av JavaScript -->
        </div>
        <div id="standings-tabs-content">
            <!-- Tabellinnehåll för grupper genereras här av JavaScript -->
            <div class="text-center text-gray-500 p-8 col-span-full">Laddar tabeller...</div>
        </div>

        <!-- Målskytteliga sektion -->
        <h2 class="section-heading">Målskytteliga</h2>
        <div id="top-scorers-list" class="table-container">
            <div class="text-center text-gray-500 p-4">Laddar målskytteliga...</div>
        </div>

        <!-- Alla Matchresultat sektion -->
        <h2 class="section-heading">Alla Matchresultat</h2>
        <div id="match-results-list" class="table-container">
            <div class="text-center text-gray-500 p-4">Laddar matchresultat...</div>
        </div>
    </div>

    <!-- Global Footer -->
    <footer class="footer">
        <img src="https://i.imgur.com/9q8c3ab.png" alt="Cup Footer Logo" class="footer-logo">
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and parsed for tabeller.html');

            // !!! VIKTIGT: Kontrollera DESSA URL:er och att dina Google Sheets är publicerade som CSV !!!
            // Guide: https://support.google.com/docs/answer/183950?hl=sv (Välj "Kommaavgränsade värden (.csv)")
            const standingsCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=1900542434&single=true&output=csv'; // TABELL sheet
            const groupScheduleCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=894699500&single=true&output=csv'; // PUB_GROUP_SCHEDULE sheet
            const playerStatsCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=1809976994&single=true&output=csv'; // PLAYER_STATS sheet
            const teamsCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=213368947&single=true&output=csv'; // PUB_TEAMINFO sheet (för laglogotyper)


            const standingsTabsContentDiv = document.getElementById('standings-tabs-content');
            const matchResultsListDiv = document.getElementById('match-results-list');
            const qualifiedTeamsListDiv = document.getElementById('qualified-teams-list');
            const topScorersListDiv = document.getElementById('top-scorers-list');
            const groupTabButtonsDiv = document.getElementById('group-tab-buttons');

            let allStandingsData = [];
            let allGamesData = [];
            let allPlayerStatsData = [];
            let allTeamsData = []; // För att hämta laglogotyper
            let availableGroups = []; // Lagrar unika gruppnamn

            /**
             * Hämtar CSV-data från den angivna URL:en och avkoda den med 'utf-8'.
             * Visar felmeddelande på sidan om hämtningen misslyckas.
             * @param {string} url URL:en till CSV-filen.
             * @param {HTMLElement} errorDisplayElement Elementet där felmeddelandet ska visas.
             * @param {string} sectionName Namnet på sektionen för felmeddelandet.
             * @returns {Promise<string>} Ett löfte som löser med den avkodade CSV-texten.
             */
            async function fetchCsvData(url, errorDisplayElement, sectionName) {
                console.log(`Attempting to fetch CSV from: ${url} for ${sectionName}`);
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorMessage = `Kunde inte ladda data för ${sectionName}. Kontrollera att URL:en är korrekt och att Google Sheet är publicerat som CSV. (HTTP Status: ${response.status})`;
                        console.error(errorMessage, url);
                        errorDisplayElement.innerHTML = `<div class="text-center text-red-600 font-bold p-4">${errorMessage}</div>`;
                        return '';
                    }
                    console.log(`Successfully fetched CSV from: ${url} for ${sectionName}`);

                    // Läs svaret som text, vilket standardiserar till UTF-8
                    const decodedText = await response.text();

                    return decodedText;

                } catch (error) {
                    const errorMessage = `Nätverksfel vid laddning av data för ${sectionName}. Kontrollera din internetanslutning eller Google Sheet URL.`;
                    console.error(errorMessage, url, error);
                    errorDisplayElement.innerHTML = `<div class="text-center text-red-600 font-bold p-4">${errorMessage}</div>`;
                    return '';
                }
            }

            /**
             * En robust CSV-parserfunktion som hanterar fält med kommatecken och citationstecken.
             * @param {string} csvText CSV-innehållet som en sträng.
             * @returns {Array<Array<string>>} En array av rader, där varje rad är en array av strängvärden.
             */
            function parseRobustCsv(csvText) {
                const rows = [];
                const lines = csvText.split('\n').filter(line => line.trim() !== '');

                if (lines.length === 0) return [];

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const values = [];
                    let inQuote = false;
                    let currentField = '';

                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        const nextChar = line[j + 1];

                        if (char === '"') {
                            if (inQuote && nextChar === '"') {
                                currentField += char;
                                j++;
                            } else {
                                inQuote = !inQuote;
                            }
                        } else if (char === ',' && !inQuote) {
                            values.push(currentField.trim());
                            currentField = '';
                        } else {
                            currentField += char;
                        }
                    }
                    values.push(currentField.trim());
                    rows.push(values);
                }
                console.log(`Parsed ${rows.length - 1} data rows.`);
                return rows.slice(1); // Returnera alla rader utom rubrikraden (header)
            }

            /**
             * Parsar CSV-text till en array av tabellobjekt från TABELL.
             * FÖRUTSATT KOLUMNORDNING (viktigt!): Lag|Grupp|M|V|O|F|GM|IM|MS|P|Nästa
             * @param {string} csvText The CSV content as a string.
             * @returns {Array<Object>} En array av lagobjekt för tabellen.
             */
            function parseStandingsCsv(csvText) {
                const rawRows = parseRobustCsv(csvText);
                if (rawRows.length === 0) {
                    console.warn("Standings CSV är tom eller felaktigt parsad.");
                    return [];
                }

                const standings = [];
                const headers = [
                    'teamName', 'group', 'matchesPlayed', 'wins', 'draws',
                    'losses', 'goalsFor', 'goalsAgainst', 'goalDifference', 'points', 'nextMatch'
                ];

                rawRows.forEach((values, index) => {
                    if (values.length >= headers.length) {
                        const entry = {};
                        headers.forEach((header, colIndex) => {
                            let value = values[colIndex] ? values[colIndex].trim() : 'N/A';
                            if (['matchesPlayed', 'wins', 'draws', 'losses', 'goalsFor', 'goalsAgainst', 'goalDifference', 'points'].includes(header)) {
                                entry[header] = parseInt(value) || 0; // Försök konvertera till nummer, annars 0
                            } else {
                                entry[header] = value;
                            }
                        });
                        standings.push(entry);
                    } else {
                        console.warn(`Hoppar över felaktig tabellrad ${index + 2}: Inte tillräckligt med kolumner (förväntade ${headers.length}, hittade ${values.length}). Radinnehåll: "${values.join(',')}"`);
                    }
                });
                return standings;
            }

            /**
             * Parsar CSV-text till en array av spelobjekt från PUB_GROUP_SCHEDULE.
             * FÖRUTSATT KOLUMNORDNING (viktigt!): Matchid|Time|Hemma|Borta|Plansponsor|Group|Resultat|Matchstatus
             * @param {string} csvText The CSV content as a string.
             * @returns {Array<Object>} En array av spelobjekt.
             */
            function parseGroupScheduleCsv(csvText) {
                const rawRows = parseRobustCsv(csvText);
                if (rawRows.length === 0) {
                    console.warn("Group Schedule CSV är tom eller felaktigt parsad.");
                    return [];
                }

                const games = [];
                // Uppdaterade headers för PUB_GROUP_SCHEDULE
                const headers = ['matchId', 'time', 'team1', 'team2', 'venue', 'group', 'result', 'matchStatus'];

                rawRows.forEach((values, index) => {
                    if (values.length >= headers.length) {
                        const game = {
                            matchId: values[0] ? values[0].trim() : 'N/A',
                            time: values[1] ? values[1].trim() : 'N/A',
                            team1: values[2] ? values[2].trim() : 'N/A',
                            team2: values[3] ? values[3].trim() : 'N/A',
                            venue: values[4] ? values[4].trim() : 'N/A',
                            group: values[5] ? values[5].trim() : 'N/A',
                            result: values[6] ? values[6].trim() : 'N/A',
                            matchStatus: values[7] ? values[7].trim() : 'N/A' // Ny kolumn för status
                        };
                        games.push(game);
                    } else {
                        console.warn(`Hoppar över felaktig schemarad ${index + 2}: Inte tillräckligt med kolumner (förväntade ${headers.length}, hittade ${values.length}). Radinnehåll: "${values.join(',')}"`);
                    }
                });
                return games;
            }

            /**
             * Parsar CSV-text till en array av spelarstatsobjekt från PLAYER_STATS.
             * FÖRUTSATT KOLUMNORDNING (viktigt!): team|playerName|group|jerseyNumber|goals|yellowCards|redCards
             * @param {string} csvText The CSV content as a string.
             * @returns {Array<Object>} En array av spelarstatsobjekt.
             */
            function parsePlayerStatsCsv(csvText) {
                const rawRows = parseRobustCsv(csvText);
                if (rawRows.length === 0) {
                    console.warn("Player Stats CSV är tom eller felaktigt parsad.");
                    return [];
                }

                const stats = [];
                // Headers based on the new PLAYER_STATS sheet structure: team|playerName|group|jerseyNumber|goals|yellowCards|redCards
                const headers = [
                    'team', 'playerName', 'group', 'jerseyNumber',
                    'goals', 'yellowCards', 'redCards'
                ];

                rawRows.forEach((values, index) => {
                    if (values.length >= headers.length) {
                        const playerStats = {
                            team: values[0] ? values[0].trim() : 'N/A',           // team
                            playerName: values[1] ? values[1].trim() : 'N/A',     // playerName
                            group: values[2] ? values[2].trim() : 'N/A',          // group
                            jerseyNumber: parseInt(values[3]) || 'N/A',           // jerseyNumber
                            goals: parseInt(values[4]) || 0,                      // goals
                            yellowCards: parseInt(values[5]) || 0,                // yellowCards
                            redCards: parseInt(values[6]) || 0                    // redCards
                        };
                        stats.push(playerStats);
                    } else {
                        console.warn(`Hoppar över felaktig spelarstatistikrad ${index + 2}: Inte tillräckligt med kolumner (förväntade ${headers.length}, hittade ${values.length}). Radinnehåll: "${values.join(',')}"`);
                    }
                });
                return stats;
            }

            /**
             * Parsar CSV-text till en array av lagobjekt. Används för att hämta logotyper.
             * FÖRUTSATT KOLUMNORDNING (viktigt!):
             * teamName|logo|captainName|group|teamDescription|teamStyle|secretWeapon|highlightOps|groupThreat|teamExp|celebration|motto|playersRaw|sponsor|sponsorLogo
             * @param {string} csvText CSV-innehållet som en sträng.
             * @returns {Array<Object>} En array av lagobjekt.
             */
            function parseTeamsCsv(csvText) {
                const rawRows = parseRobustCsv(csvText);
                if (rawRows.length === 0) {
                    console.warn("Teams CSV is empty or parsing resulted in no data.");
                    return [];
                }

                const teams = [];
                // Kolumnordning enligt senaste specifikationen:
                // teamName (0), logo (1), captainName (2), group (3), teamDescription (4),
                // teamStyle (5), secretWeapon (6), highlightOps (7), groupThreat (8),
                // teamExp (9), celebration (10), motto (11), playersRaw (12),
                // sponsor (13), sponsorLogo (14)
                const headersCount = 15; // Antal förväntade kolumner

                rawRows.forEach((values, index) => {
                    if (values.length >= headersCount) {
                        const team = {
                            teamName: values[0] ? values[0].trim() : 'N/A',
                            logo: (values[1] && isValidImageUrl(values[1])) ? values[1].trim() : 'https://placehold.co/100x100/aabbcc/ffffff?text=Lag+Logo',
                            captainName: values[2] ? values[2].trim() : 'N/A',
                            group: values[3] ? values[3].trim() : 'N/A',
                            teamDescription: values[4] ? values[4].trim() : 'N/A',
                            teamStyle: values[5] ? values[5].trim() : 'N/A',
                            secretWeapon: values[6] ? values[6].trim() : 'N/A',
                            highlightOps: values[7] ? values[7].trim() : 'N/A',
                            groupThreat: values[8] ? values[8].trim() : 'N/A',
                            teamExp: values[9] ? values[9].trim() : 'N/A',
                            celebration: values[10] ? values[10].trim() : 'N/A',
                            motto: values[11] ? values[11].trim() : 'N/A',
                            playersRaw: values[12] ? values[12].trim() : '',
                            sponsor: values[13] ? values[13].trim() : 'N/A',
                            sponsorLogo: (values[14] && isValidImageUrl(values[14])) ? values[14].trim() : 'N/A' // Nu förväntas sponsorLogo vara en direkt URL
                        };
                        teams.push(team);
                    } else {
                        console.warn(`Hoppar över felaktig lagrad ${index + 2}: Inte tillräckligt med kolumner (förväntade ${headersCount}, hittade ${values.length}). Radinnehåll: "${values.join(',')}"`);
                    }
                });
                return teams;
            }


            /**
             * Hämtar en lags logotyp-URL.
             * @param {string} teamName Namnet på laget.
             * @returns {string} Logotypens URL eller en platshållar-URL.
             */
            function getTeamLogo(teamName) {
                const team = allTeamsData.find(t => t.teamName === teamName);
                return (team && team.logo && isValidImageUrl(team.logo)) ? team.logo : 'https://placehold.co/100x100/aabbcc/ffffff?text=Lag+Logo';
            }

            /**
             * Kontrollerar om en URL ser ut som en giltig bild-URL.
             * @param {string} url
             * @returns {boolean}
             */
            function isValidImageUrl(url) {
                return (url.startsWith('http://') || url.startsWith('https://')) &&
                    (/\.(jpeg|jpg|gif|png|webp|svg)$/i.test(url));
            }

            /**
             * Rendrar tabellen för en specifik grupp.
             * @param {string} groupName Namnet på gruppen att rendera.
             */
            function renderGroupStandings(groupName) {
                const groupContainerId = `standings-tab-${groupName.replace(/\s+/g, '-')}`;
                let groupSection = document.getElementById(groupContainerId);

                if (!groupSection) {
                    groupSection = document.createElement('div');
                    groupSection.id = groupContainerId;
                    groupSection.className = 'tab-content table-container';
                    standingsTabsContentDiv.appendChild(groupSection);
                }

                const teamsInGroup = allStandingsData.filter(team => team.group === groupName);

                // Sortera lag: Poäng (högst först), Målskillnad (högst först), Gjorda Mål (högst först)
                teamsInGroup.sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                    return b.goalsFor - a.goalsFor;
                });

                groupSection.innerHTML = `
                    <h3 class="group-heading">${groupName}</h3>
                    <div class="overflow-x-auto rounded-lg shadow-md">
                        <table class="standings-table">
                            <thead>
                                <tr>
                                    <th>Lag</th>
                                    <th title="Matcher Spelade">M</th>
                                    <th title="Vinster">V</th>
                                    <th title="Oavgjorda">O</th>
                                    <th title="Förluster">F</th>
                                    <th title="Gjorda Mål">GM</th>
                                    <th title="Insläppta Mål">IM</th>
                                    <th title="Målskillnad">MS</th>
                                    <th title="Poäng">P</th>
                                    <th title="Nästa Match">Nästa</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${teamsInGroup.map(team => `
                                    <tr>
                                        <td class="team-cell" data-label="Lag">
                                            <img src="${getTeamLogo(team.teamName)}" alt="${team.teamName} Logo" class="team-logo-small" onerror="this.onerror=null; this.src='https://placehold.co/100x100/aabbcc/ffffff?text=Lag+Logo';">
                                            ${team.teamName}
                                        </td>
                                        <td data-label="M">${team.matchesPlayed}</td>
                                        <td data-label="V">${team.wins}</td>
                                        <td data-label="O">${team.draws}</td>
                                        <td data-label="F">${team.losses}</td>
                                        <td data-label="GM">${team.goalsFor}</td>
                                        <td data-label="IM">${team.goalsAgainst}</td>
                                        <td data-label="MS">${team.goalDifference}</td>
                                        <td class="points-cell" data-label="P">${team.points}</td>
                                        <td data-label="Nästa">${team.nextMatch || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                console.log(`Standings rendered for group: ${groupName}`);
            }

            /**
             * Rendrar slutspelsträdet.
             */
            function renderTournamentBracket() {
                const bracketContainerId = 'standings-tab-Slutspelsträdet';
                let bracketSection = document.getElementById(bracketContainerId);

                if (!bracketSection) {
                    bracketSection = document.createElement('div');
                    bracketSection.id = bracketContainerId;
                    bracketSection.className = 'tab-content tournament-bracket'; // Använd den nya klassen här
                    standingsTabsContentDiv.appendChild(bracketSection);
                }

                // Logic to determine group winners and runners-up
                const groupWinners = {}; // { 'A': teamObject, 'B': teamObject, ... }
                const groupRunnersUp = {}; // { 'A': teamObject, 'B': teamObject, ... }

                // Group teams and sort them to find winners and runners-up
                const groupedByGroup = allStandingsData.reduce((acc, team) => {
                    const group = team.group || 'Okänd Grupp';
                    if (!acc[group]) {
                        acc[group] = [];
                    }
                    acc[group].push(team);
                    return acc;
                }, {});

                Object.keys(groupedByGroup).sort().forEach(groupName => {
                    const teamsInGroup = groupedByGroup[groupName];
                    teamsInGroup.sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                        return b.goalsFor - a.goalsFor;
                    });
                    if (teamsInGroup.length > 0) {
                        groupWinners[groupName] = teamsInGroup[0];
                    }
                    if (teamsInGroup.length > 1) {
                        groupRunnersUp[groupName] = teamsInGroup[1];
                    }
                });

                // Define Quarterfinal matchups based on standard bracket logic (e.g., A1 vs B2, B1 vs A2, etc.)
                // This assumes 4 groups (A, B, C, D)
                const qfMatches = [
                    {
                        id: 'QF1',
                        team1: groupWinners['A']?.teamName || 'Vinnare Grupp A',
                        team2: groupRunnersUp['B']?.teamName || 'Tvåa Grupp B',
                        result: '? - ?'
                    },
                    {
                        id: 'QF2',
                        team1: groupWinners['B']?.teamName || 'Vinnare Grupp B',
                        team2: groupRunnersUp['A']?.teamName || 'Tvåa Grupp A',
                        result: '? - ?'
                    },
                    {
                        id: 'QF3',
                        team1: groupWinners['C']?.teamName || 'Vinnare Grupp C',
                        team2: groupRunnersUp['D']?.teamName || 'Tvåa Grupp D',
                        result: '? - ?'
                    },
                    {
                        id: 'QF4',
                        team1: groupWinners['D']?.teamName || 'Vinnare Grupp D',
                        team2: groupRunnersUp['C']?.teamName || 'Tvåa Grupp C',
                        result: '? - ?'
                    }
                ];

                bracketSection.innerHTML = `
                    <h3 class="group-heading">Slutspelsträdet</h3>
                    <div class="bracket-stages">
                        <!-- Kvartsfinaler -->
                        <div class="bracket-stage">
                            <h4 class="text-xl font-bold text-gray-700 mb-4">Kvartsfinaler</h4>
                            ${qfMatches.map(match => `
                                <div class="match-card">
                                    <span class="team-name">${match.team1}</span>
                                    <span class="vs-separator">vs</span>
                                    <span class="team-name">${match.team2}</span>
                                    <span class="score">${match.result}</span>
                                </div>
                            `).join('')}
                        </div>
                        <!-- Semifinaler -->
                        <div class="bracket-stage">
                            <h4 class="text-xl font-bold text-gray-700 mb-4">Semifinaler</h4>
                            <div class="match-card">
                                <span class="team-name">Vinnare QF1</span>
                                <span class="vs-separator">vs</span>
                                <span class="team-name">Vinnare QF2</span>
                                <span class="score">? - ?</span>
                            </div>
                            <div class="match-card">
                                <span class="team-name">Vinnare QF3</span>
                                <span class="vs-separator">vs</span>
                                <span class="team-name">Vinnare QF4</span>
                                <span class="score">? - ?</span>
                            </div>
                        </div>
                        <!-- Final -->
                        <div class="bracket-stage">
                            <h4 class="text-xl font-bold text-gray-700 mb-4">Final</h4>
                            <div class="match-card">
                                <span class="team-name">Vinnare SF1</span>
                                <span class="vs-separator">vs</span>
                                <span class="team-name">Vinnare SF2</span>
                                <span class="score">? - ?</span>
                            </div>
                            <div class="winner-display">
                                Vinnare: <br>[Cupens Mästare]
                            </div>
                        </div>
                    </div>
                `;
                console.log('Tournament bracket rendered.');
            }


            /**
             * Hanterar visning av flikar.
             * @param {string} tabId ID för fliken som ska visas.
             */
            function showTab(tabId) {
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                // Deactivate all buttons
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.classList.remove('active');
                });

                // Show the selected tab content
                const activeTabContent = document.getElementById(tabId);
                if (activeTabContent) {
                    activeTabContent.classList.add('active');
                }

                // Activate the corresponding button
                const activeButton = document.querySelector(`.tab-button[data-tab-id="${tabId}"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
                console.log(`Tab "${tabId}" activated.`);
            }

            /**
             * Rendrar knapparna för grupptabellerna och slutspelsträdet.
             */
            function renderGroupTabButtons() {
                groupTabButtonsDiv.innerHTML = ''; // Clear existing buttons
                const uniqueGroups = new Set(allStandingsData.map(team => team.group).filter(g => g && g !== 'N/A'));
                availableGroups = Array.from(uniqueGroups).sort(); // Store for later use

                // Add group buttons
                availableGroups.forEach(group => {
                    const button = document.createElement('button');
                    button.className = 'tab-button';
                    button.textContent = group;
                    button.setAttribute('data-tab-id', `standings-tab-${group.replace(/\s+/g, '-')}`);
                    button.addEventListener('click', () => {
                        renderGroupStandings(group); // Render group table when clicked
                        showTab(`standings-tab-${group.replace(/\s+/g, '-')}`);
                    });
                    groupTabButtonsDiv.appendChild(button);
                });

                // Add Tournament Bracket button
                const bracketButton = document.createElement('button');
                bracketButton.className = 'tab-button';
                bracketButton.textContent = 'Slutspelsträdet';
                bracketButton.setAttribute('data-tab-id', 'standings-tab-Slutspelsträdet');
                bracketButton.addEventListener('click', () => {
                    renderTournamentBracket(); // Call the new bracket rendering function
                    showTab('standings-tab-Slutspelsträdet');
                });
                groupTabButtonsDiv.appendChild(bracketButton);

                // Show the first group's tab by default if groups exist
                if (availableGroups.length > 0) {
                    renderGroupStandings(availableGroups[0]);
                    showTab(`standings-tab-${availableGroups[0].replace(/\s+/g, '-')}`);
                } else {
                    // Fallback if no groups are found, show bracket or a general message
                    if (bracketButton) { // If bracket button exists, show bracket
                        renderTournamentBracket();
                        showTab('standings-tab-Slutspelsträdet');
                    } else { // Else, show a general message
                        standingsTabsContentDiv.innerHTML = `<div class="text-center text-gray-500 p-8 col-span-full">Inga grupper hittades för tabeller.</div>`;
                    }
                }
                console.log('Group tab buttons rendered.');
            }

            /**
             * Rendrar kvalificerade lag för slutspel.
             */
            function renderQualifiedTeams() {
                console.log('renderQualifiedTeams called. Clearing qualified teams list.');
                qualifiedTeamsListDiv.innerHTML = '';
                if (allStandingsData.length === 0) {
                    qualifiedTeamsListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Ingen tabellinformation tillgänglig för att bestämma kvalificerade lag. Se till att "TABELL" Google Sheet laddas korrekt.</div>`;
                    console.warn('No standings data for qualified teams.');
                    return;
                }

                const groupedByGroup = allStandingsData.reduce((acc, team) => {
                    const group = team.group || 'Okänd Grupp';
                    if (!acc[group]) {
                        acc[group] = [];
                    }
                    acc[group].push(team);
                    return acc;
                }, {});

                let qualifiedTeams = [];
                Object.keys(groupedByGroup).sort().forEach(groupName => {
                    const teamsInGroup = groupedByGroup[groupName];
                    teamsInGroup.sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        if (b.goalDifference !== a.goalDifference) return b.goalDifference - a.goalDifference;
                        return b.goalsFor - a.goalsFor;
                    });
                    // Lägg till topp 2 lag från varje grupp
                    qualifiedTeams.push(...teamsInGroup.slice(0, 2));
                });

                if (qualifiedTeams.length === 0) {
                    qualifiedTeamsListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Inga lag är för närvarande kvalificerade för slutspel.</div>`;
                    console.warn('No qualified teams to display.');
                    return;
                }

                qualifiedTeamsListDiv.innerHTML = `
                    <div class="qualified-teams-grid">
                        ${qualifiedTeams.map(team => `
                            <div class="qualified-team-card">
                                ${team.teamName} (${team.group})
                            </div>
                        `).join('')}
                    </div>
                `;
                console.log(`Rendered ${qualifiedTeams.length} qualified teams.`);
            }

            /**
             * Renderar alla matchresultat.
             */
            function renderMatchResults() {
                console.log('renderMatchResults called. Clearing match results list.');
                matchResultsListDiv.innerHTML = '';
                if (allGamesData.length === 0) {
                    matchResultsListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Inga matchresultat hittades. Kontrollera Google Sheet "PUB_GROUP_SCHEDULE".</div>`;
                    console.warn('No match results to display.');
                    return;
                }

                // Filtrera ut matcher som har status 'Slutrapporterad'
                const completedMatches = allGamesData.filter(game => game.matchStatus === 'Slutrapporterad');

                // En enkel sortering efter tid, kan förbättras om datum/matchID-ordning önskas
                completedMatches.sort((a, b) => {
                    const timeA = a.time.replace(':', '');
                    const timeB = b.time.replace(':', '');
                    return parseInt(timeA) - parseInt(timeB);
                });
                console.log(`Found ${completedMatches.length} completed matches.`);

                matchResultsListDiv.innerHTML = `
                    <div class="overflow-x-auto rounded-lg shadow-md">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Matchid</th>
                                    <th>Tid</th>
                                    <th>Hemma</th>
                                    <th>Borta</th>
                                    <th>Resultat</th>
                                    <th>Anmärkning</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${completedMatches.map(game => `
                                    <tr>
                                        <td data-label="Matchid">${game.matchId}</td>
                                        <td data-label="Tid">${game.time}</td>
                                        <td data-label="Hemma">${game.team1}</td>
                                        <td data-label="Borta">${game.team2}</td>
                                        <td data-label="Resultat" class="font-bold">${game.result}</td>
                                        <td data-label="Anmärkning">${game.matchStatus && game.matchStatus !== 'N/A' ? game.matchStatus : ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                console.log('Match results rendered.');
            }

            /**
             * Renderar målskytteligan.
             */
            function renderTopScorers() {
                console.log('renderTopScorers called. Clearing top scorers list.');
                topScorersListDiv.innerHTML = '';
                if (allPlayerStatsData.length === 0) {
                    topScorersListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Inga målskyttestatistik hittades. Kontrollera Google Sheet "PLAYER_STATS".</div>`;
                    console.warn('No player stats data for top scorers.');
                    return;
                }

                // Filtrera ut spelare med mål och sortera efter mål i fallande ordning
                const scorers = allPlayerStatsData.filter(player => player.goals > 0);
                scorers.sort((a, b) => b.goals - a.goals);
                console.log(`Found ${scorers.length} top scorers.`);

                topScorersListDiv.innerHTML = `
                    <div class="overflow-x-auto rounded-lg shadow-md">
                        <table class="top-scorer-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Namn</th>
                                    <th>Lag</th>
                                    <th>Mål</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${scorers.map((player, index) => `
                                    <tr>
                                        <td data-label="Rank">${index + 1}</td>
                                        <td data-label="Namn">${player.playerName || 'N/A'}</td>
                                        <td data-label="Lag">${player.team || 'N/A'}</td>
                                        <td data-label="Mål" class="goals-cell">${player.goals}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                console.log('Top scorers rendered.');
            }

            // Initial laddning av all data
            async function initializeTablesPage() {
                console.log('initializeTablesPage called.');
                // Initiala laddningsmeddelanden
                qualifiedTeamsListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Laddar kvalificerade lag...</div>`;
                topScorersListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Laddar målskytteliga...</div>`;
                matchResultsListDiv.innerHTML = `<div class="text-center text-gray-500 p-4">Laddar matchresultat...</div>`;
                groupTabButtonsDiv.innerHTML = ''; // Clear buttons initially
                standingsTabsContentDiv.innerHTML = `<div class="text-center text-gray-500 p-8 col-span-full">Laddar tabeller...</div>`; // Keep this initial message until tabs are rendered


                // Försök att hämta alla data samtidigt
                const [standingsCsvText, groupScheduleCsvText, playerStatsCsvText, teamsCsvText] = await Promise.all([
                    fetchCsvData(standingsCsvUrl, standingsTabsContentDiv, "Grupptabeller"),
                    fetchCsvData(groupScheduleCsvUrl, matchResultsListDiv, "Matchresultat"),
                    fetchCsvData(playerStatsCsvUrl, topScorersListDiv, "Målskytteliga"),
                    fetchCsvData(teamsCsvUrl, standingsTabsContentDiv, "Laglogotyper") // Fetch team data for logos
                ]);

                // Parsa data endast om den hämtades framgångsrikt
                allStandingsData = standingsCsvText ? parseStandingsCsv(standingsCsvText) : [];
                allGamesData = groupScheduleCsvText ? parseGroupScheduleCsv(groupScheduleCsvText) : [];
                allPlayerStatsData = playerStatsCsvText ? parsePlayerStatsCsv(playerStatsCsvText) : [];
                allTeamsData = teamsCsvText ? parseTeamsCsv(teamsCsvText) : []; // Parse team data

                // Rendera sektionerna baserat på den tillgängliga datan
                renderQualifiedTeams();
                renderGroupTabButtons(); // This will also render the first group's table or its fallback
                renderTopScorers();
                renderMatchResults();
                console.log('Tables page initialized and rendered successfully.');

                // Check if ALL data is empty (only if parsing itself resulted in no data for critical sections)
                // This final check covers cases where all relevant CSVs fail or are empty.
                if (allStandingsData.length === 0 && allGamesData.length === 0 && allPlayerStatsData.length === 0) {
                    console.error("All data sources are empty or failed to load. Displaying a general error.");
                    standingsTabsContentDiv.innerHTML = `<div class="text-center text-red-600 font-bold col-span-full p-8">
                                                            Kunde inte ladda någon data för tabellsidan. Kontrollera alla Google Sheets URL:er och publiceringsinställningar.
                                                            <br>
                                                            <a href="https://support.google.com/docs/answer/183950?hl=sv" target="_blank" class="text-blue-600 hover:underline">Hur du publicerar Google Sheet till webben (Google Support)</a>
                                                        </div>`;
                    // Clear other divs if this general error is the final state
                    qualifiedTeamsListDiv.innerHTML = '';
                    matchResultsListDiv.innerHTML = '';
                    topScorersListDiv.innerHTML = '';
                    groupTabButtonsDiv.innerHTML = '';
                }
            }

            initializeTablesPage();
        });
    </script>
</body>

</html>