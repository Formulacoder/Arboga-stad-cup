<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lagregister</title>
    <!-- Tailwind CSS CDN för styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Ljusgrå bakgrund */
            min-height: 100vh; /* Säkerställer att bakgrunden täcker hela sidan */
            display: flex;
            flex-direction: column; /* För att navbaren ska ligga överst */
            align-items: center;
            justify-content: flex-start; /* Justera för navbar */
            padding: 0; /* Ta bort padding från body */
        }
        .navbar {
            width: 100%;
            background-color: #1a202c; /* Mörk bakgrund för navbar */
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky; /* Kvar på toppen vid scroll */
            top: 0;
            z-index: 1000; /* Säkerställ att den ligger över annat innehåll */
        }
        .navbar a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.2s ease-in-out;
            font-weight: 500;
        }
        .navbar a:hover {
            background-color: #4a5568; /* Mörkare grå vid hover */
        }
        .content-container {
            max-width: 960px; /* max-w-4xl är ca 960px */
            width: 100%;
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem 1.5rem; /* Justerad padding */
            margin-top: 2rem; /* Marginal från navbar */
            margin-bottom: 2rem;
        }
        .team-card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-lg */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Skugga för djup */
            transition: transform 0.2s ease-in-out;
        }
        .team-card:hover {
            transform: translateY(-3px); /* Subtil lyft vid hover */
        }
        .player-list {
            list-style: none;
            padding-left: 0;
        }
        .player-list li {
            padding: 0.2rem 0;
            display: flex;
            align-items: center;
        }
        .player-role-icon {
            margin-right: 0.5rem;
            font-size: 0.9em;
            color: #4a5568; /* Grå färg för ikoner */
        }
        .player-name {
            font-weight: 500;
        }
        @media (max-width: 640px) { /* För mobil (sm breakpoint) */
            .navbar-links {
                flex-direction: column;
                align-items: center;
            }
            .navbar a {
                width: 100%;
                text-align: center;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body class="flex flex-col">
    <!-- Global Navigationsmeny -->
    <nav class="navbar">
        <div class="max-w-4xl mx-auto flex flex-col sm:flex-row justify-between items-center">
            <div class="font-bold text-xl mb-2 sm:mb-0">Arboga Stad Cup</div>
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4 navbar-links">
                <a href="index.html">Startsida</a>
                <a href="fotbollsschema.html">Spelschema</a>
                <a href="lagregister.html">Lagregister</a>
                <a href="spelaregister.html">Spelarregister</a>
                <a href="sponsorer.html">Samarbetspartners</a>
                <a href="aktiviteter.html">Aktiviteter</a>
            </div>
        </div>
    </nav>

    <div class="content-container">
        <!-- Rubriksektion -->
        <header class="text-center mb-8 relative">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Lagregister</h1>
            <p class="text-lg text-gray-600">Översikt över alla deltagande lag och deras spelare.</p>
            <!-- Länk till startsidan tas bort härifrån eftersom den nu finns i navbaren -->
        </header>

        <!-- Sökfält och filter (Kan läggas till senare om önskas) -->
        <!-- Just nu visar vi bara alla lag -->

        <!-- Laglistningssektion -->
        <div id="team-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Lagkort kommer att renderas här av JavaScript -->
            <div class="text-center text-gray-500 p-8 col-span-full">Laddar lagregister...</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // !!! VIKTIGT !!!
            // Denna URL pekar nu på din dedikerade PUB_TEAMINFO Google Sheet.
            // Se till att din Google Sheet är publicerad som "Comma-separated values (.csv)".
            // Se också till att 'Logo'-kolumnen innehåller DIREKTA BILD-URL:er (t.ex. https://example.com/logo.png), inte länkar till Google Drive-visningssidor.
            const teamsCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=213368947&single=true&output=csv'; 

            const teamListDiv = document.getElementById('team-list');

            let allTeams = []; // Lagrar rådata för lag från CSV

            /**
             * Hämtar CSV-data från den angivna URL:en.
             * @param {string} url URL:en till CSV-filen.
             * @returns {Promise<string>} Ett löfte som löser med CSV-texten.
             */
            async function fetchCsvData(url) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP fel! status: ${response.status}`);
                    }
                    return await response.text();
                } catch (error) {
                    console.error('Fel vid hämtning av CSV-data:', error);
                    teamListDiv.innerHTML = `<div class="text-center text-red-600 font-bold col-span-full p-4">
                                                Fel vid laddning av lagregister. <br>
                                                Se till att du har publicerat ditt Google Sheet med lagdata till webben som CSV
                                                och att 'teamsCsvUrl' i koden är korrekt.
                                                <br>
                                                <a href="https://support.google.com/docs/answer/183950?hl=sv" target="_blank" class="text-blue-600 hover:underline">Hur du publicerar Google Sheet till webben (Google Support)</a>
                                                <p class="mt-2 text-sm text-gray-700">Kontrollera också att logotyp-URL:erna i ditt Google Sheet är DIREKTA bildlänkar (slutar på .png/.jpg etc.) och inte Google Drive-visningslänkar.</p>
                                            </div>`;
                    return ''; // Returnera tom sträng för att förhindra ytterligare fel
                }
            }

            /**
             * Parsar CSV-text till en array av lagobjekt.
             * VIKTIGT: Denna funktion förväntar sig att kolumnerna är i DENNA SPECIFIKA ORDNING:
             * Lagnamn|Logo|Lagkapten|Samarbetspartner|Grupp|Spelare (K=Kapten, MV=Keeper)|TEAM_DESCRIPTION|TEAM_STYLE|SECRET_WEAPON|HIGHLIGHT_OPS|GROUP_THREAT|TEAM_EXP|CELEBRATION|MOTTO|BetStats
             * Om kolumnordningen i ditt Google Sheet är annorlunda, MÅSTE du justera indexen nedan.
             * @param {string} csvText CSV-innehållet som en sträng.
             * @returns {Array<Object>} En array av lagobjekt.
             */
            function parseTeamsCsv(csvText) {
                const lines = csvText.split('\n').filter(line => line.trim() !== ''); // Dela upp efter rad, filtrera bort tomma rader
                if (lines.length <= 1) { // Kräver minst rubrik + en datarad för att parsa lag
                    console.warn("CSV har inga datarader för lag eller bara rubriker.");
                    return []; 
                }

                const teams = [];
                // Kolumnmappning baserat på din angivna ordning
                const headers = [
                    'teamName', 'logo', 'captainName', 'sponsor', 'group', 'playersRaw',
                    'teamDescription', 'teamStyle', 'secretWeapon', 'highlightOps',
                    'groupThreat', 'teamExp', 'celebration', 'motto', 'betStats'
                ];

                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',');
                    // Säkerställ att tillräckligt med kolumner finns för en giltig lagpost
                    if (values.length >= headers.length) { 
                        const team = {
                            teamName: values[0] ? values[0].trim() : 'N/A',
                            logo: values[1] ? values[1].trim() : 'https://placehold.co/100x100/aabbcc/ffffff?text=Team+Logo', // Platshållarbild om ingen URL finns
                            captainName: values[2] ? values[2].trim() : 'N/A',
                            sponsor: values[3] ? values[3].trim() : 'N/A',
                            group: values[4] ? values[4].trim() : 'N/A',
                            playersRaw: values[5] ? values[5].trim() : '', // Råsträng med spelare
                            teamDescription: values[6] ? values[6].trim() : 'N/A',
                            teamStyle: values[7] ? values[7].trim() : 'N/A',
                            secretWeapon: values[8] ? values[8].trim() : 'N/A',
                            highlightOps: values[9] ? values[9].trim() : 'N/A',
                            groupThreat: values[10] ? values[10].trim() : 'N/A',
                            teamExp: values[11] ? values[11].trim() : 'N/A',
                            celebration: values[12] ? values[12].trim() : 'N/A',
                            motto: values[13] ? values[13].trim() : 'N/A',
                            betStats: values[14] ? values[14].trim() : 'N/A'
                        };

                        // Parsa spelare från råsträngen
                        team.players = parsePlayers(team.playersRaw, team.captainName);
                        teams.push(team);
                    } else {
                        console.warn(`Hoppar över felaktig rad ${i + 1}: Inte tillräckligt med kolumner för lagdata (förväntade ${headers.length}, hittade ${values.length}). Radinnehåll: "${lines[i]}"`);
                    }
                }
                return teams;
            }

            /**
             * Parsar spelarsträngen till en array av spelarobjekt med roller.
             * Exempel input: "Erick Dominguez (K),Sebastian Hanhe (MV),Kylian Chaath"
             * @param {string} playersString Råsträng med spelare.
             * @param {string} explicitCaptainName Namnet på den explicit angivna kaptenen från "Lagkapten" kolumnen.
             * @returns {Array<Object>} Array av spelarobjekt.
             */
            function parsePlayers(playersString, explicitCaptainName) {
                const players = [];
                if (!playersString) return players;

                playersString.split(',').forEach(playerEntry => {
                    const name = playerEntry.replace('(K)', '').replace('(MV)', '').trim();
                    if (name) {
                        const isCaptain = playerEntry.includes('(K)') || (explicitCaptainName && name === explicitCaptainName);
                        const isGoalkeeper = playerEntry.includes('(MV)');
                        players.push({
                            name: name,
                            isCaptain: isCaptain,
                            isGoalkeeper: isGoalkeeper
                        });
                    }
                });
                return players;
            }

            /**
             * Renderar lagregistret.
             */
            function renderTeamRegister() {
                teamListDiv.innerHTML = ''; // Rensa tidigare lagkort

                if (allTeams.length === 0) {
                    teamListDiv.innerHTML = `<div class="text-center text-gray-500 col-span-full p-8">Inga lag hittades i registret.</div>`;
                    return;
                }

                allTeams.forEach(team => {
                    const teamCard = document.createElement('div');
                    teamCard.className = `team-card p-6 border border-gray-200`;

                    const playerListHtml = team.players.map(player => `
                        <li>
                            ${player.isCaptain ? '<span class="player-role-icon" title="Kapten">👑</span>' : ''}
                            ${player.isGoalkeeper ? '<span class="player-role-icon" title="Målvakt">🧤</span>' : ''}
                            <span class="player-name">${player.name}</span>
                        </li>
                    `).join('');

                    teamCard.innerHTML = `
                        <div class="flex items-center mb-4">
                            <img src="${team.logo}" alt="${team.teamName} Logo" class="w-16 h-16 rounded-full mr-4 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/100x100/aabbcc/ffffff?text=Team+Logo';">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-900">${team.teamName}</h2>
                                <p class="text-gray-600">Grupp: ${team.group}</p>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-2">
                            <span class="font-medium">Lagkapten:</span> ${team.captainName || 'N/A'}
                        </p>
                        <p class="text-gray-700 mb-2">
                            <span class="font-medium">Samarbetspartner:</span> ${team.sponsor || 'N/A'}
                        </p>
                        ${team.teamDescription && team.teamDescription !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Beskrivning:</span> ${team.teamDescription}</p>` : ''}
                        ${team.teamStyle && team.teamStyle !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Spelstil:</span> ${team.teamStyle}</p>` : ''}
                        ${team.secretWeapon && team.secretWeapon !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Hemlig Vapen:</span> ${team.secretWeapon}</p>` : ''}
                        ${team.highlightOps && team.highlightOps !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Highlight Ops:</span> ${team.highlightOps}</p>` : ''}
                        ${team.groupThreat && team.groupThreat !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Största Hotet (Grupp):</span> ${team.groupThreat}</p>` : ''}
                        ${team.teamExp && team.teamExp !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Tidigare Erfarenhet:</span> ${team.teamExp}</p>` : ''}
                        ${team.celebration && team.celebration !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Målfirande:</span> ${team.celebration}</p>` : ''}
                        ${team.motto && team.motto !== 'N/A' ? `<p class="text-gray-700 mb-2"><span class="font-medium">Motto:</span> ${team.motto}</p>` : ''}
                        ${team.betStats && team.betStats !== 'N/A' ? `<p class="text-gray-700 mb-4"><span class="font-medium">BetStats:</span> ${team.betStats}</p>` : ''}
                        
                        <h4 class="text-lg font-semibold text-gray-800 mb-2">Spelare:</h4>
                        <ul class="player-list">
                            ${playerListHtml || '<li>Inga spelare listade.</li>'}
                        </ul>
                    `;
                    teamListDiv.appendChild(teamCard);
                });
            }

            // Initial laddning av data
            async function initializeTeamRegister() {
                const csvText = await fetchCsvData(teamsCsvUrl);
                if (csvText) {
                    allTeams = parseTeamsCsv(csvText);
                    renderTeamRegister();
                }
            }

            initializeTeamRegister();
        });
    </script>
</body>
</html>
