<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arboga Stad Cup - Samarbetspartners</title>
    <!-- Tailwind CSS CDN för styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            /* Ljusgrå bakgrund */
            min-height: 100vh;
            /* Säkerställer att bakgrunden täcker hela sidan */
            display: flex;
            flex-direction: column;
            /* För att navbaren ska ligga överst */
            align-items: center;
            justify-content: flex-start;
            /* Justera för navbar */
            padding: 0;
            /* Ta bort padding från body */
        }

        .navbar {
            width: 100%;
            background-color: #1a202c;
            /* Mörk bakgrund för navbar */
            color: white;
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            /* Kvar på toppen vid scroll */
            top: 0;
            z-index: 1000;
            /* Säkerställ att den ligger över annat innehåll */
            display: flex;
            /* Använd flexbox */
            align-items: center;
            /* Centrera vertikalt */
            justify-content: flex-start;
            /* Starta objekt från vänster */
            flex-wrap: wrap;
            /* Tillåt objekt att bryta rad om utrymmet är begränsat */
        }

        .navbar-home-logo {
            height: 2.5rem;
            /* Storlek på logotypen som hemknapp */
            margin-right: 1.5rem;
            /* Mer utrymme till höger om logotypen */
            cursor: pointer;
            border-radius: 9999px;
            /* Rundad */
            transition: transform 0.2s ease-in-out;
            flex-shrink: 0;
            /* Förhindra att logotypen krymper */
        }

        .navbar-home-logo:hover {
            transform: scale(1.05);
            /* Lätt förstoring vid hover */
        }

        .navbar-links-wrapper {
            display: flex;
            flex-wrap: wrap;
            /* Tillåt länkar att bryta rad */
            gap: 0.5rem;
            /* Litet mellanrum mellan länkar */
            flex-grow: 1;
            /* Tillåt länkomslutningen att ta tillgängligt utrymme */
            justify-content: center;
            /* Centrera länkar inom deras omslutning på små skärmar om de bryter rad */
        }

        .navbar a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 0.8rem;
            /* Något minskad padding för kompakthet */
            border-radius: 0.375rem;
            /* rounded-md */
            transition: background-color 0.2s ease-in-out;
            font-weight: 500;
            white-space: nowrap;
            /* Förhindra att länkar bryter text */
        }

        .navbar a:hover {
            background-color: #4a5568;
            /* Mörkare grå vid hover */
        }

        .content-container {
            max-width: 960px;
            /* max-w-4xl är ca 960px */
            width: 100%;
            background-color: #ffffff;
            border-radius: 0.75rem;
            /* rounded-xl */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 2rem 1.5rem;
            /* Justerad padding */
            margin-top: 2rem;
            /* Marginal från navbar */
            margin-bottom: 2rem;
            flex-grow: 1;
            /* Låter innehållskontainern växa och pressa ner footern */
        }

        /* Flexbox för att centrera hela sponsorkortlistan */
        #sponsor-list {
            display: flex;
            flex-wrap: wrap;
            /* Tillåt kort att bryta rad */
            justify-content: center;
            /* Centrera korten horisontellt */
            gap: 1.5rem;
            /* Mellanrum mellan korten */
        }

        .sponsor-card {
            background-color: #f7fafc;
            /* Ljusare bakgrund för sponsor kort */
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Centrera objekt i kortet */
            text-align: center;
            /* Centrera text i kortet */
            width: calc(33.333% - 1rem);
            /* Standard 3 kolumner, justerat för gap */
            min-width: 280px;
            /* Minsta bredd */
            max-width: 320px;
            /* Maxbredd för att undvika för breda kort på större skärmar */
        }

        .sponsor-card.single-sponsor-total {
            /* Stil för ensam sponsor på HELA sidan */
            width: 80%;
            /* Ta mer bredd */
            max-width: 500px;
            /* Maxbredd för ensam sponsor */
            padding: 2.5rem;
            /* Mer padding */
        }

        .sponsor-card.single-sponsor-total .sponsor-logo {
            max-width: 15rem;
            /* Större logotyp */
            max-height: 12rem;
            /* Större logotyp */
        }

        .sponsor-card.single-sponsor-total .text-xl {
            font-size: 2.5rem;
            /* Större text */
        }

        .sponsor-card.single-sponsor-total .text-sm {
            font-size: 1.25rem;
            /* Större text */
        }

        .sponsor-logo {
            max-width: 10rem;
            /* Maximal bredd */
            max-height: 8rem;
            /* Maximal höjd */
            height: auto;
            /* Behåll proportioner */
            width: auto;
            /* Behåll proportioner */
            object-fit: scale-down;
            /* Skala ner stora bilder, skala inte upp små */
            margin-bottom: 1rem;
            border-radius: 0.25rem;
            /* Lätt rundade hörn */
        }

        .sponsor-website {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
            margin-top: 0.5rem;
            display: block;
            /* För att länken ska ta upp egen rad */
        }

        .sponsor-website:hover {
            text-decoration: underline;
        }

        .category-heading {
            width: 100%;
            text-align: center;
            font-size: 2.25rem;
            /* text-4xl */
            font-weight: 800;
            /* font-extrabold */
            color: #4a5568;
            /* grå text */
            margin-top: 2rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #cbd5e0;
            /* Lätt grå linje under rubrik */
        }

        /* Footer styling */
        .footer {
            width: 100%;
            background-color: #1a202c;
            /* Mörk bakgrund för footer */
            padding: 1.5rem;
            text-align: center;
            margin-top: auto;
            /* Trycker ner footern till botten */
        }

        .footer-logo {
            max-width: 100%;
            /* Anpassa till skärmbredden */
            height: 6rem;
            /* FAST HÖJD FÖR FOTLOGOTYPEN, ÖKAD FRÅN 4REM TILL 6REM */
            object-fit: contain;
            /* Behåll proportioner, se till att hela bilden syns */
            display: block;
            /* Centrera bilden */
            margin: 0 auto;
            /* Centrera bilden horisontellt */
        }

        @media (max-width: 640px) {

            /* För mobil (sm breakpoint) */
            .navbar {
                flex-direction: column;
                /* Stapla logotyp och länkar vertikalt */
                align-items: center;
                /* Centrera allt */
            }

            .navbar-home-logo {
                margin-right: 0;
                /* Ingen marginal till höger om logotypen om den är centrerad */
                margin-bottom: 1rem;
                /* Avstånd till länkarna nedanför */
            }

            .navbar-links-wrapper {
                width: 100%;
                /* Ta full bredd under logotypen */
                justify-content: center;
                /* Centrera länkar inom deras omslutning på små skärmar om de bryter rad */
            }

            .navbar a {
                width: auto;
                /* Låt länkarna bestämma sin egen bredd */
            }

            .sponsor-card {
                width: calc(50% - 0.75rem);
                /* 2 kolumner på smala skärmar */
            }

            .sponsor-card.single-sponsor-total {
                width: 90%;
                /* Mer plats på små skärmar */
            }
        }

        @media (max-width: 480px) {

            /* Extra liten skärm, en kolumn */
            .sponsor-card {
                width: 100%;
                /* En kolumn på mycket små skärmar */
                min-width: unset;
                /* Ta bort minsta bredd */
            }
        }
    </style>
</head>

<body class="flex flex-col">
    <!-- Global Navigationsmeny -->
    <nav class="navbar">
        <a href="index.html">
            <img src="https://i.imgur.com/pwnWIDU.png" alt="Arboga Stad SK Logo" class="navbar-home-logo">
        </a>
        <div class="navbar-links-wrapper">
            <a href="index.html">Startsida</a>
            <a href="fotbollsschema.html">Spelschema</a>
            <a href="lagregister.html">Lagregister</a>
            <a href="spelaregister.html">Spelarregister</a>
            <a href="tabeller.html">Tabeller</a>
            <a href="sponsorer.html">Samarbetspartners</a>
            <a href="aktiviteter.html">Aktiviteter</a>
            <a href="efterfesten.html">Efterfesten</a>
        </div>
    </nav>

    <div class="content-container">
        <!-- Rubriksektion -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Våra Samarbetspartners</h1>
            <p class="text-lg text-gray-600">Ett stort tack till alla som möjliggör cupen!</p>
        </header>

        <!-- Sponsorslistningssektion -->
        <div id="sponsor-list">
            <!-- Sponsor kort kommer att renderas här av JavaScript -->
            <div class="text-center text-gray-500 p-8 col-span-full">Laddar samarbetspartners...</div>
        </div>
    </div>

    <!-- Global Footer -->
    <footer class="footer">
        <img src="https://i.imgur.com/9q8c3ab.png" alt="Cup Footer Logo" class="footer-logo">
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and parsed for sponsorer.html');

            // !!! VIKTIGT !!!
            // Denna URL pekar nu på din dedikerade PUB_PARTNERS Google Sheet.
            // Se till att din Google Sheet är publicerad som "Comma-separated values (.csv)".
            const partnersCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSA5hxt_CRmSr2oUS4azErMtLNn70vBLm-n8uHSK4RgpJNccOat05jV9F02iDF0ViM4dPzsVhrjWZ2O/pub?gid=1030318842&single=true&output=csv';

            const sponsorListDiv = document.getElementById('sponsor-list');

            let allPartnersData = []; // Lagrar rådata från partners CSV

            /**
             * Hämtar CSV-data från den angivna URL:en.
             * @param {string} url URL:en till CSV-filen.
             * @returns {Promise<string>} Ett löfte som löser med CSV-texten.
             */
            async function fetchCsvData(url) {
                console.log(`Attempting to fetch CSV from: ${url}`);
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorMsg = `HTTP Error! status: ${response.status} fetching ${url}`;
                        console.error(errorMsg);
                        throw new Error(errorMsg);
                    }
                    console.log(`Successfully fetched CSV from: ${url}`);
                    return await response.text();
                } catch (error) {
                    console.error('Fel vid hämtning av CSV-data från:', url, error);
                    sponsorListDiv.innerHTML = `<div class="text-center text-red-600 font-bold col-span-full p-4">
                                                    Fel vid laddning av samarbetspartners. <br>
                                                    Se till att du har publicerat ditt Google Sheet med partnerdata till webben som CSV
                                                    och att 'partnersCsvUrl' i koden är korrekt.
                                                    <br>
                                                    <a href="https://support.google.com/docs/answer/183950?hl=sv" target="_blank" class="text-blue-600 hover:underline">Hur du publicerar Google Sheet till webben (Google Support)</a>
                                                    <p class="mt-2 text-sm text-gray-700">Kontrollera att kolumnerna stämmer och att logotyp-URL:erna är DIREKTA bildlänkar.</p>
                                                </div>`;
                    throw error;
                }
            }

            /**
             * En robust CSV-parserfunktion som hanterar fält med kommatecken och citationstecken.
             * Förutsätter att fält som innehåller kommatecken är omslutna av dubbla citationstecken.
             * Hanterar även dubbla citationstecken inom citerade fält (genom att fördubbla dem, t.ex. "He said ""Hello""").
             * @param {string} csvText CSV-innehållet som en sträng.
             * @returns {Array<Array<string>>} En array av rader, där varje rad är en array av strängvärden.
             */
            function parseRobustCsv(csvText) {
                const rows = [];
                const lines = csvText.split('\n').filter(line => line.trim() !== '');

                if (lines.length === 0) { // Tom CSV eller bara whitespace-rader
                    return [];
                }

                // Bearbeta dataraderna (hoppa över rubrikraden för intern parsning)
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const values = [];
                    let inQuote = false;
                    let currentField = '';

                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        const nextChar = line[j + 1];

                        if (char === '"') {
                            if (inQuote && nextChar === '"') { // Hantera dubbla citationstecken inuti ett citerat fält ("" blir ")
                                currentField += char;
                                j++; // Hoppa över nästa citationstecken
                            } else {
                                inQuote = !inQuote; // Växla in/ut ur citerat läge
                            }
                        } else if (char === ',' && !inQuote) {
                            values.push(currentField.trim());
                            currentField = '';
                        } else {
                            currentField += char;
                        }
                    }
                    values.push(currentField.trim()); // Lägg till det sista fältet på raden
                    rows.push(values);
                }
                console.log(`Parsed ${rows.length - 1} data rows.`);
                return rows.slice(1); // Returnera alla rader utom rubrikraden
            }

            /**
             * Parsar CSV-text till en array av partnerobjekt.
             * VIKTIGT: Denna funktion förväntar sig kolumnerna i DENNA SPECIFIKA ORDNING:
             * Samarbetspartner, Roll, Beskrivning, webbsida, Logo1Default, Logo2, Logo3, Logo4, Logo5
             * Om kolumnordningen i ditt Google Sheet är annorlunda, MÅSTE du justera indexen nedan.
             * @param {string} csvText CSV-innehållet som en sträng.
             * @returns {Array<Object>} En array av partnerobjekt.
             */
            function parsePartnersCsv(csvText) {
                const rawRows = parseRobustCsv(csvText);
                if (rawRows.length === 0) {
                    console.warn("Partners CSV is empty or parsing resulted in no data.");
                    return [];
                }

                const partners = [];
                // Kolumnmappning baserat på din NYA angivna ordning för PUB_PARTNERS
                // Samarbetspartner, Roll, Beskrivning, webbsida, Logo1Default, Logo2, Logo3, Logo4, Logo5
                const headers = [
                    'name', 'role', 'description', 'website', 'logo1Default'
                ];

                rawRows.forEach((values, index) => {
                    // Kontrollera att tillräckligt med kolumner finns för de obligatoriska fälten
                    if (values.length >= headers.length) {
                        const partner = {
                            name: values[0] ? values[0].trim() : 'N/A',
                            role: values[1] ? values[1].trim() : 'N/A', // Roll är nu på index 1
                            description: values[2] ? values[2].trim() : 'N/A', // Beskrivning är nu på index 2
                            website: values[3] ? values[3].trim() : '', // Webbsida är nu på index 3
                            // Vi använder 'Logo1Default' (index 4) som primär logotyp
                            logo: (values[4] && isValidImageUrl(values[4])) ? values[4].trim() :
                                'https://placehold.co/128x128/eeeeee/333333?text=Sponsor+Logo'
                        };
                        partners.push(partner);
                    } else {
                        console.warn(`Hoppar över felaktig partnerrad ${index + 2}: Inte tillräckligt med kolumner (förväntade ${headers.length}, hittade ${values.length}).`);
                    }
                });
                return partners;
            }

            /**
             * Kontrollerar om en URL ser ut som en giltig bild-URL.
             * @param {string} url
             * @returns {boolean}
             */
            function isValidImageUrl(url) {
                return (url.startsWith('http://') || url.startsWith('https://')) &&
                    (/\.(jpeg|jpg|gif|png|webp|svg)$/i.test(url));
            }

            /**
             * Renderar listan över samarbetspartners, grupperade efter roll.
             */
            function renderSponsors() {
                console.log('renderSponsors called. Clearing sponsor list.');
                sponsorListDiv.innerHTML = ''; // Rensa tidigare innehåll

                if (allPartnersData.length === 0) {
                    sponsorListDiv.innerHTML = `<div class="text-center text-gray-500 p-8 col-span-full">Inga samarbetspartners hittades.</div>`;
                    console.warn('No partners to display.');
                    return;
                }

                // Gruppera partners efter deras roll
                const groupedPartners = allPartnersData.reduce((acc, partner) => {
                    const role = partner.role && partner.role !== 'N/A' ? partner.role : 'Övriga partners';
                    if (!acc[role]) {
                        acc[role] = [];
                    }
                    acc[role].push(partner);
                    return acc;
                }, {});

                // Definiera önskad ordning för kategorierna
                const categoryOrder = [
                    'Huvudpartner',
                    'Officiell partner', // Flyttad upp
                    'Lagsponsor', // Flyttad ner
                    'Vän till Vallen',
                    'Övriga partners' // Fallback för de som inte matchar eller saknar roll
                ];

                // Hämta alla unika roller som faktiskt finns i datan, utöver de definierade
                const existingRoles = Object.keys(groupedPartners);
                const customRoles = existingRoles.filter(role => !categoryOrder.includes(role));

                // Lägg till eventuella "egna" roller sist, sorterade alfabetiskt
                const finalCategoryOrder = [...categoryOrder.filter(role => existingRoles.includes(role)), ...customRoles.sort()];

                // Kontrollera om det bara finns EN sponsor totalt
                const totalSponsors = allPartnersData.length;
                const isSingleTotalSponsor = totalSponsors === 1;
                console.log('Total sponsors:', totalSponsors, 'Is single sponsor total:', isSingleTotalSponsor);


                // Renderar varje kategori och dess partners
                finalCategoryOrder.forEach(category => {
                    const partnersInCategory = groupedPartners[category];
                    if (partnersInCategory && partnersInCategory.length > 0) {
                        const categorySection = document.createElement('div');
                        categorySection.className = 'w-full';
                        // Visa inte rubriken om det bara är en sponsor totalt, då blir den större och mer prominent
                        if (!isSingleTotalSponsor) {
                            categorySection.innerHTML = `<h2 class="category-heading">${category}</h2>`;
                        }
                        sponsorListDiv.appendChild(categorySection);

                        const categoryGrid = document.createElement('div');
                        // Om det bara är en sponsor totalt, centrera den och ge den mer utrymme
                        categoryGrid.className = `flex flex-wrap justify-center gap-6 mb-8`; // Använd flexbox för att centrera

                        // Sortera partners inom varje kategori alfabetiskt efter namn
                        partnersInCategory.sort((a, b) => a.name.localeCompare(b.name)).forEach(partner => {
                            const sponsorCard = document.createElement('div');
                            // Använd 'single-sponsor-total' klassen om det bara finns en sponsor totalt
                            sponsorCard.className = `sponsor-card ${isSingleTotalSponsor ? 'single-sponsor-total' : ''}`;

                            const imageUrl = isValidImageUrl(partner.logo) ? partner.logo : 'https://placehold.co/128x128/eeeeee/333333?text=Sponsor+Logo';

                            sponsorCard.innerHTML = `
                                <img src="${imageUrl}" alt="${partner.name} Logo" class="sponsor-logo" onerror="this.onerror=null; this.src='https://placehold.co/128x128/eeeeee/333333?text=Sponsor+Logo';">
                                <h3 class="text-xl font-bold text-gray-800">${partner.name || 'N/A'}</h3>
                                ${partner.website && partner.website !== 'N/A' ? `<a href="${partner.website}" target="_blank" rel="noopener noreferrer" class="sponsor-website">Besök webbsida</a>` : ''}
                                ${partner.description && partner.description !== 'N/A' ? `<p class="text-gray-600 text-sm mt-1">${partner.description}</p>` : ''}
                            `;
                            categoryGrid.appendChild(sponsorCard);
                        });
                        sponsorListDiv.appendChild(categoryGrid);
                    }
                });
                console.log(`Rendered sponsors across ${finalCategoryOrder.length} categories.`);
            }

            // Initial laddning av data
            async function initializeSponsors() {
                console.log('initializeSponsors called.');
                sponsorListDiv.innerHTML = `<div class="text-center text-gray-500 p-8 col-span-full">Laddar samarbetspartners...</div>`;
                try {
                    console.time('Fetch Partners CSV');
                    const csvText = await fetchCsvData(partnersCsvUrl);
                    allPartnersData = parsePartnersCsv(csvText);
                    console.timeEnd('Fetch Partners CSV');
                    console.log('allPartnersData loaded:', allPartnersData.length, 'partners');
                    renderSponsors();
                    console.log('Sponsors page initialized and rendered successfully.');
                } catch (error) {
                    console.error("Felsökning: Ett fel uppstod vid initialisering av sponsorsidan.", error);
                    // Felmeddelande visas redan av fetchCsvData
                }
            }

            initializeSponsors();
        });
    </script>
</body>

</html>